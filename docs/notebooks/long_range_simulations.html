<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Computational Models for Complex system - Long range dispersal model</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Computational Models for Complex system</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/iretes/rock-scissors-paper" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#discrete-time-model" id="toc-discrete-time-model" class="nav-link active" data-scroll-target="#discrete-time-model">1. Discrete-time model</a>
  <ul class="collapse">
  <li><a href="#finite-population-size" id="toc-finite-population-size" class="nav-link" data-scroll-target="#finite-population-size">1.1. Finite population size</a></li>
  <li><a href="#large-population-size" id="toc-large-population-size" class="nav-link" data-scroll-target="#large-population-size">1.2. Large population size</a></li>
  </ul></li>
  <li><a href="#continuous-time-model" id="toc-continuous-time-model" class="nav-link" data-scroll-target="#continuous-time-model">2. Continuous-time model</a></li>
  <li><a href="#stochastic-simulation-of-chemical-reactions" id="toc-stochastic-simulation-of-chemical-reactions" class="nav-link" data-scroll-target="#stochastic-simulation-of-chemical-reactions">3. Stochastic simulation of chemical reactions</a></li>
  <li><a href="#stochastic-model-checking" id="toc-stochastic-model-checking" class="nav-link" data-scroll-target="#stochastic-model-checking">4. Stochastic model checking</a></li>
  <li><a href="#petri-net-analysis" id="toc-petri-net-analysis" class="nav-link" data-scroll-target="#petri-net-analysis">5. Petri net analysis</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">6. References</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Long range dispersal model</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>This notebook simulates the evolution of a three-species system with long-range dispersal.</p>
<p><strong>Outline</strong></p>
<ul>
<li><a href="#1.-Discrete-time-model">1. Discrete-time model</a>
<ul>
<li><a href="#1.1.-Finite-population-size">1.1. Finite population size</a></li>
<li><a href="#1.2.-Large-population-size">1.2. Large population size</a></li>
</ul></li>
<li><a href="#2.-Continuous-time-model">2. Continuous-time model</a></li>
<li><a href="#3.-Stochastic-simulation-of-chemical-reactions">3. Stochastic simulation of chemical reactions</a></li>
<li><a href="#4.-Stochastic-model-checking">4. Stochastic model checking</a></li>
<li><a href="#5.-Petri-net-analysis">5. Petri net analysis</a></li>
<li><a href="#6.-References">6. References</a></li>
</ul>
<p>Importing the necessary libraries:</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.express <span class="im">as</span> px</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.graph_objects <span class="im">as</span> go</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> colormaps</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.integrate <span class="im">import</span> odeint</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> graphviz <span class="im">import</span> Source</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sympy <span class="im">import</span> symbols, Matrix, Eq, solve</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="discrete-time-model" class="level2">
<h2 class="anchored" data-anchor-id="discrete-time-model">1. Discrete-time model</h2>
<section id="finite-population-size" class="level3">
<h3 class="anchored" data-anchor-id="finite-population-size">1.1. Finite population size</h3>
<p>We consider a model world that has <span class="math inline">\(N\)</span> available sites. The sites are occupied by three species, namely species <span class="math inline">\(r\)</span> (rock), <span class="math inline">\(s\)</span> (scissors) and <span class="math inline">\(p\)</span> (paper), which occur in the proportions <span class="math inline">\(n_r\)</span> , <span class="math inline">\(n_s\)</span> and <span class="math inline">\(n_p\)</span> (with <span class="math inline">\(n_r + n_s + n_p = 1\)</span>). Two sites are chosen at each time-step. The occupant of the first replicates into the second with a given probability - individual of species <span class="math inline">\(r\)</span> can invade a species <span class="math inline">\(s\)</span> with probability <span class="math inline">\(P_r\)</span>, a species <span class="math inline">\(s\)</span> invades a species <span class="math inline">\(p\)</span> with probability <span class="math inline">\(P_s\)</span>, a species <span class="math inline">\(p\)</span> invades a species <span class="math inline">\(r\)</span> with probability <span class="math inline">\(P_p\)</span> and all other invasion probabilities are zero.</p>
<p>Defining a function to simulate the evolution of the system for a world with <span class="math inline">\(N\)</span> sites:</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> simulate_finite_N(Pr, Ps, Pp, nr_init, ns_init, N<span class="op">=</span><span class="dv">1000</span>, epochs<span class="op">=</span><span class="dv">100</span>):</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">'''</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Simulate the evolution of a population of three species over time</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">    on a model world that has N available sites.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co">    Pr : float</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co">        The probability that a species of type r invades a species of type s.</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co">    Ps : float</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co">        The probability that a species of type s invades a species of type p.</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co">    Pp : float</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co">        The probability that a species of type p invades a species of type r.</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co">    nr_init : float</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co">        The initial proportion of species r in the population.</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="co">    ns_init : float</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="co">        The initial proportion of species s in the population.</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="co">    N : int</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="co">        The number of sites.</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="co">    epochs : int</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="co">        The number of time units to simulate.</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="co">    '''</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> check_P(P):</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> P <span class="op">&lt;</span> <span class="dv">0</span> <span class="kw">or</span> P <span class="op">&gt;</span> <span class="dv">1</span>:</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">'Pr, Ps and Pp must be between 0 and 1'</span>)</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>    check_P(Pr)</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>    check_P(Ps)</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>    check_P(Pp)</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> nr_init <span class="op">+</span> ns_init <span class="op">&gt;</span> <span class="dv">1</span>:</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">'Initial species proportions must be less than 1'</span>)</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> N <span class="op">&lt;</span> <span class="dv">1</span>:</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">'Number of sites must be at least 1'</span>)</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> epochs <span class="op">&lt;</span> <span class="dv">1</span>:</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">'Number of steps must be at least 1'</span>)</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>    sites <span class="op">=</span> numpy.zeros(N)</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>    nr <span class="op">=</span> []</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>    ns <span class="op">=</span> []</span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>    np <span class="op">=</span> []</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>    r_id <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>    s_id <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>    p_id <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initialize the sites</span></span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(N):</span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>        sites[i] <span class="op">=</span> numpy.random.choice([r_id, s_id, p_id], p<span class="op">=</span>[nr_init, ns_init, <span class="dv">1</span><span class="op">-</span>nr_init<span class="op">-</span>ns_init])</span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>    nr.append(numpy.<span class="bu">sum</span>(sites <span class="op">==</span> r_id) <span class="op">/</span> N)</span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>    ns.append(numpy.<span class="bu">sum</span>(sites <span class="op">==</span> s_id) <span class="op">/</span> N)</span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>    np.append(numpy.<span class="bu">sum</span>(sites <span class="op">==</span> p_id) <span class="op">/</span> N)</span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, epochs):</span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> step <span class="kw">in</span> <span class="bu">range</span>(N):</span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>            <span class="co"># choose two random sites</span></span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>            i <span class="op">=</span> numpy.random.randint(<span class="dv">0</span>, N)</span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>            j <span class="op">=</span> numpy.random.randint(<span class="dv">0</span>, N)</span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> sites[i] <span class="op">==</span> r_id <span class="kw">and</span> sites[j] <span class="op">==</span> s_id: <span class="co"># rock beats scissors</span></span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> numpy.random.rand() <span class="op">&lt;</span> Pr:</span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>                    sites[j] <span class="op">=</span> r_id</span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> sites[i] <span class="op">==</span> s_id <span class="kw">and</span> sites[j] <span class="op">==</span> p_id: <span class="co"># scissors beats paper</span></span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> numpy.random.rand() <span class="op">&lt;</span> Ps:</span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>                    sites[j] <span class="op">=</span> s_id</span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> sites[i] <span class="op">==</span> p_id <span class="kw">and</span> sites[j] <span class="op">==</span> r_id: <span class="co"># paper beats rock</span></span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> numpy.random.rand() <span class="op">&lt;</span> Pp:</span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a>                    sites[j] <span class="op">=</span> p_id</span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a>        nr.append(numpy.<span class="bu">sum</span>(sites <span class="op">==</span> r_id) <span class="op">/</span> N)</span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a>        ns.append(numpy.<span class="bu">sum</span>(sites <span class="op">==</span> s_id) <span class="op">/</span> N)</span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a>        np.append(numpy.<span class="bu">sum</span>(sites <span class="op">==</span> p_id) <span class="op">/</span> N)</span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>        <span class="co"># if two species go extinct, stop the simulation</span></span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">sum</span>([numpy.isclose(nr[<span class="op">-</span><span class="dv">1</span>], <span class="dv">0</span>, <span class="fl">1e-4</span>),</span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a>                numpy.isclose(ns[<span class="op">-</span><span class="dv">1</span>], <span class="dv">0</span>, <span class="fl">1e-4</span>),</span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a>                numpy.isclose(np[<span class="op">-</span><span class="dv">1</span>], <span class="dv">0</span>, <span class="fl">1e-4</span>)</span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a>            ]) <span class="op">&gt;=</span> <span class="dv">2</span>:</span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.DataFrame({<span class="st">'$n_r$'</span>: nr, <span class="st">'$n_s$'</span>: ns, <span class="st">'$n_p$'</span>: np})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Defining functions to plot the evolution of the system:</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> line_plot_species_evolution(df, title<span class="op">=</span><span class="va">None</span>, show_markers<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">'''</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Plot the evolution of species proportions over time in a line plot.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co">    df : pd.DataFrame</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co">        A DataFrame containing the species proportions over time.</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co">    title : str</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co">        The title of the plot.</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co">    '''</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> df.plot(</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>        figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">4</span>),</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>        style<span class="op">=</span><span class="st">'o-'</span> <span class="cf">if</span> show_markers <span class="cf">else</span> <span class="st">'-'</span>, color<span class="op">=</span>[<span class="st">'tab:red'</span>, <span class="st">'purple'</span>, <span class="st">'gold'</span>],</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span>title,</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>        xlabel<span class="op">=</span><span class="st">'Time'</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> show_markers:</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> line <span class="kw">in</span> ax.get_lines():</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>            line.set_markeredgecolor(<span class="st">'black'</span>)</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> phase_plot_species_evolution(df, title<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">'''</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="co">    Plot the evolution of species proportions over time in a phase plot.</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a><span class="co">    df : pd.DataFrame</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a><span class="co">        A DataFrame containing the species proportions over time.</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a><span class="co">    title : str</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a><span class="co">        The title of the plot.</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a><span class="co">    '''</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>    fig, axs <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">5</span>), sharey<span class="op">=</span><span class="va">True</span>, sharex<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>    cmap <span class="op">=</span> colormaps[<span class="st">'Blues'</span>]</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> cmap(np.linspace(<span class="dv">0</span>, <span class="dv">1</span>, (df[df.columns[<span class="dv">0</span>]].shape[<span class="dv">0</span>]<span class="op">-</span><span class="dv">1</span>))) </span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>        axs[i].plot(df[df.columns[i]][<span class="dv">0</span>:<span class="op">-</span><span class="dv">1</span>], df[df.columns[i]][<span class="dv">1</span>:], <span class="st">'-'</span>, color<span class="op">=</span><span class="st">'k'</span>, zorder<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>        axs[i].scatter(df[df.columns[i]][<span class="dv">0</span>:<span class="op">-</span><span class="dv">1</span>], df[df.columns[i]][<span class="dv">1</span>:], c<span class="op">=</span>colors, s<span class="op">=</span><span class="dv">50</span>, zorder<span class="op">=</span><span class="dv">2</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>        axs[i].set_title(df.columns[i])</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>    fig.suptitle(title)<span class="op">;</span></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>    fig.tight_layout()</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ternary_plot_species_evolution(df, title<span class="op">=</span><span class="va">None</span>, show_markers<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>    <span class="co">'''</span></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a><span class="co">    Plot the evolution of species proportions over time in a ternary plot.</span></span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a><span class="co">    df : pd.DataFrame</span></span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a><span class="co">        A DataFrame containing the species proportions over time.</span></span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a><span class="co">    title : str</span></span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a><span class="co">        The title of the plot.</span></span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a><span class="co">    '''</span></span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> px.scatter_ternary(</span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>        df,</span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>        a<span class="op">=</span>df.columns[<span class="dv">2</span>],</span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>        b<span class="op">=</span>df.columns[<span class="dv">0</span>],</span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>        c<span class="op">=</span>df.columns[<span class="dv">1</span>],</span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span>df.index,</span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a>        color_continuous_scale<span class="op">=</span><span class="st">'blues'</span>,</span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>        size_max<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span>title</span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> show_markers:</span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>        fig.update_traces(mode<span class="op">=</span><span class="st">'lines+markers'</span>, line<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span><span class="st">'black'</span>, width<span class="op">=</span><span class="dv">1</span>),</span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a>            marker<span class="op">=</span><span class="bu">dict</span>(symbol<span class="op">=</span><span class="st">'circle'</span>, line<span class="op">=</span><span class="bu">dict</span>(width<span class="op">=</span><span class="dv">1</span>, color<span class="op">=</span><span class="st">'black'</span>)))</span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a>        fig.update_traces(mode<span class="op">=</span><span class="st">'lines'</span>, line<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span><span class="st">'black'</span>, width<span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a>    fig.update_layout(coloraxis_colorbar<span class="op">=</span><span class="bu">dict</span>(title<span class="op">=</span><span class="st">'Time'</span>))</span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a>    fig.show(<span class="st">'png'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Simulating the evolution of the system with <span class="math inline">\(P_r = 0.2\)</span>, <span class="math inline">\(P_s = 0.5\)</span>, <span class="math inline">\(P_p = 0.3\)</span>, <span class="math inline">\(N = 100\)</span> initialized with population densities close to the fixed point (<span class="math inline">\(n_r=0.5\)</span>, <span class="math inline">\(n_s=0.3\)</span>, <span class="math inline">\(n_p=0.2\)</span>):</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>fp_finite_N_df <span class="op">=</span> simulate_finite_N(Pr<span class="op">=</span><span class="fl">0.2</span>, Ps<span class="op">=</span><span class="fl">0.5</span>, Pp<span class="op">=</span><span class="fl">0.3</span>, nr_init<span class="op">=</span><span class="fl">0.5</span>, ns_init<span class="op">=</span><span class="fl">0.3</span>, N<span class="op">=</span><span class="dv">1000</span>, epochs<span class="op">=</span><span class="dv">1000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Plotting the evolution of the system:</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>line_plot_species_evolution(</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    fp_finite_N_df,</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">'N=1000, $P_r=0.2$, $P_s=0.5$, $P_p=0.3$, $n_r^0$=0.5, $n_s^0$=0.3'</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="long_range_simulations_files/figure-html/cell-6-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>ternary_plot_species_evolution(</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    fp_finite_N_df,</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="vs">r"$N=1000, P_r=0.2, P_s=0.5, P_p=0.3, n_r^0=0.5, n_s^0=0.3$"</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="long_range_simulations_files/figure-html/cell-7-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>In a finite world, the populations move from orbit to orbit, with two species (scissors and paper) eventually becoming extinct. The species that survives (rock) is the one that has the lowest invasion rate.</p>
<p>Performing simulations for a range of invasion probabilities chosen to sum to unity, initializing the population densities close to the fixed point and recording the surviving species:</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># defining a grid of points for invasion probabilities</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>R, S <span class="op">=</span> np.mgrid[<span class="dv">0</span>:<span class="dv">1</span>:<span class="ot">20j</span>, <span class="dv">0</span>:<span class="dv">1</span>:<span class="ot">20j</span>]</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>R, S <span class="op">=</span> R.ravel(), S.ravel()</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>P <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> R <span class="op">-</span> S</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>I <span class="op">=</span> np.array([R, S, P]).T</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co"># keeping only invasion probabilities greater than 0.01</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>I <span class="op">=</span> I[np.<span class="bu">all</span>(I <span class="op">&gt;</span> <span class="fl">0.01</span>, axis<span class="op">=</span><span class="dv">1</span>)]</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>R <span class="op">=</span> I[:, <span class="dv">0</span>]</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>S <span class="op">=</span> I[:, <span class="dv">1</span>]</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>P <span class="op">=</span> I[:, <span class="dv">2</span>]</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co"># total number of simulations to run</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>num_sim <span class="op">=</span> <span class="bu">len</span>(I)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="co"># number of sites </span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>N <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="co"># maximum number of iterations</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>EPOCHS <span class="op">=</span> <span class="dv">2000</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="co"># list to store the winner of each simulation</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>winners <span class="op">=</span> []</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="co"># iterating over the invasion probabilities</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, (Pr, Ps, Pp) <span class="kw">in</span> <span class="bu">enumerate</span>(I):</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"[</span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>num_sim<span class="sc">}</span><span class="ss">] Running simulation for invasion probabilities: Pr=</span><span class="sc">{</span>Pr<span class="sc">:.2f}</span><span class="ss">, Ps=</span><span class="sc">{</span>Ps<span class="sc">:.2f}</span><span class="ss">, Pp=</span><span class="sc">{</span>Pp<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># simulating with the current invasion probabilities</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>    results_df <span class="op">=</span> simulate_finite_N(</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>        Pr<span class="op">=</span>Pr, Ps<span class="op">=</span>Ps, Pp<span class="op">=</span>Pp,</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>        nr_init<span class="op">=</span>Ps, ns_init<span class="op">=</span>Pp,</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>        N<span class="op">=</span>N, epochs<span class="op">=</span>EPOCHS</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># storing the winner</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> results_df.index.stop<span class="op">==</span>EPOCHS: <span class="co"># no winner</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>        winners.append(<span class="st">'None'</span>)</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> np.isclose(results_df.iloc[<span class="op">-</span><span class="dv">1</span>][<span class="st">'$n_r$'</span>], <span class="dv">1</span>, <span class="fl">1e-4</span>): <span class="co"># rock wins</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>            winners.append(<span class="st">'Rock'</span>)</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> np.isclose(results_df.iloc[<span class="op">-</span><span class="dv">1</span>][<span class="st">'$n_s$'</span>], <span class="dv">1</span>, <span class="fl">1e-4</span>): <span class="co"># scissors wins</span></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>        winners.append(<span class="st">'Scissors'</span>)</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>: <span class="co"># paper wins</span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>        winners.append(<span class="st">'Paper'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1/153] Running simulation for invasion probabilities: Pr=0.05, Ps=0.05, Pp=0.89
[2/153] Running simulation for invasion probabilities: Pr=0.05, Ps=0.11, Pp=0.84
[3/153] Running simulation for invasion probabilities: Pr=0.05, Ps=0.16, Pp=0.79
[4/153] Running simulation for invasion probabilities: Pr=0.05, Ps=0.21, Pp=0.74
[5/153] Running simulation for invasion probabilities: Pr=0.05, Ps=0.26, Pp=0.68
[6/153] Running simulation for invasion probabilities: Pr=0.05, Ps=0.32, Pp=0.63
[7/153] Running simulation for invasion probabilities: Pr=0.05, Ps=0.37, Pp=0.58
[8/153] Running simulation for invasion probabilities: Pr=0.05, Ps=0.42, Pp=0.53
[9/153] Running simulation for invasion probabilities: Pr=0.05, Ps=0.47, Pp=0.47
[10/153] Running simulation for invasion probabilities: Pr=0.05, Ps=0.53, Pp=0.42
[11/153] Running simulation for invasion probabilities: Pr=0.05, Ps=0.58, Pp=0.37
[12/153] Running simulation for invasion probabilities: Pr=0.05, Ps=0.63, Pp=0.32
[13/153] Running simulation for invasion probabilities: Pr=0.05, Ps=0.68, Pp=0.26
[14/153] Running simulation for invasion probabilities: Pr=0.05, Ps=0.74, Pp=0.21
[15/153] Running simulation for invasion probabilities: Pr=0.05, Ps=0.79, Pp=0.16
[16/153] Running simulation for invasion probabilities: Pr=0.05, Ps=0.84, Pp=0.11
[17/153] Running simulation for invasion probabilities: Pr=0.05, Ps=0.89, Pp=0.05
[18/153] Running simulation for invasion probabilities: Pr=0.11, Ps=0.05, Pp=0.84
[19/153] Running simulation for invasion probabilities: Pr=0.11, Ps=0.11, Pp=0.79
[20/153] Running simulation for invasion probabilities: Pr=0.11, Ps=0.16, Pp=0.74
[21/153] Running simulation for invasion probabilities: Pr=0.11, Ps=0.21, Pp=0.68
[22/153] Running simulation for invasion probabilities: Pr=0.11, Ps=0.26, Pp=0.63
[23/153] Running simulation for invasion probabilities: Pr=0.11, Ps=0.32, Pp=0.58
[24/153] Running simulation for invasion probabilities: Pr=0.11, Ps=0.37, Pp=0.53
[25/153] Running simulation for invasion probabilities: Pr=0.11, Ps=0.42, Pp=0.47
[26/153] Running simulation for invasion probabilities: Pr=0.11, Ps=0.47, Pp=0.42
[27/153] Running simulation for invasion probabilities: Pr=0.11, Ps=0.53, Pp=0.37
[28/153] Running simulation for invasion probabilities: Pr=0.11, Ps=0.58, Pp=0.32
[29/153] Running simulation for invasion probabilities: Pr=0.11, Ps=0.63, Pp=0.26
[30/153] Running simulation for invasion probabilities: Pr=0.11, Ps=0.68, Pp=0.21
[31/153] Running simulation for invasion probabilities: Pr=0.11, Ps=0.74, Pp=0.16
[32/153] Running simulation for invasion probabilities: Pr=0.11, Ps=0.79, Pp=0.11
[33/153] Running simulation for invasion probabilities: Pr=0.11, Ps=0.84, Pp=0.05
[34/153] Running simulation for invasion probabilities: Pr=0.16, Ps=0.05, Pp=0.79
[35/153] Running simulation for invasion probabilities: Pr=0.16, Ps=0.11, Pp=0.74
[36/153] Running simulation for invasion probabilities: Pr=0.16, Ps=0.16, Pp=0.68
[37/153] Running simulation for invasion probabilities: Pr=0.16, Ps=0.21, Pp=0.63
[38/153] Running simulation for invasion probabilities: Pr=0.16, Ps=0.26, Pp=0.58
[39/153] Running simulation for invasion probabilities: Pr=0.16, Ps=0.32, Pp=0.53
[40/153] Running simulation for invasion probabilities: Pr=0.16, Ps=0.37, Pp=0.47
[41/153] Running simulation for invasion probabilities: Pr=0.16, Ps=0.42, Pp=0.42
[42/153] Running simulation for invasion probabilities: Pr=0.16, Ps=0.47, Pp=0.37
[43/153] Running simulation for invasion probabilities: Pr=0.16, Ps=0.53, Pp=0.32
[44/153] Running simulation for invasion probabilities: Pr=0.16, Ps=0.58, Pp=0.26
[45/153] Running simulation for invasion probabilities: Pr=0.16, Ps=0.63, Pp=0.21
[46/153] Running simulation for invasion probabilities: Pr=0.16, Ps=0.68, Pp=0.16
[47/153] Running simulation for invasion probabilities: Pr=0.16, Ps=0.74, Pp=0.11
[48/153] Running simulation for invasion probabilities: Pr=0.16, Ps=0.79, Pp=0.05
[49/153] Running simulation for invasion probabilities: Pr=0.21, Ps=0.05, Pp=0.74
[50/153] Running simulation for invasion probabilities: Pr=0.21, Ps=0.11, Pp=0.68
[51/153] Running simulation for invasion probabilities: Pr=0.21, Ps=0.16, Pp=0.63
[52/153] Running simulation for invasion probabilities: Pr=0.21, Ps=0.21, Pp=0.58
[53/153] Running simulation for invasion probabilities: Pr=0.21, Ps=0.26, Pp=0.53
[54/153] Running simulation for invasion probabilities: Pr=0.21, Ps=0.32, Pp=0.47
[55/153] Running simulation for invasion probabilities: Pr=0.21, Ps=0.37, Pp=0.42
[56/153] Running simulation for invasion probabilities: Pr=0.21, Ps=0.42, Pp=0.37
[57/153] Running simulation for invasion probabilities: Pr=0.21, Ps=0.47, Pp=0.32
[58/153] Running simulation for invasion probabilities: Pr=0.21, Ps=0.53, Pp=0.26
[59/153] Running simulation for invasion probabilities: Pr=0.21, Ps=0.58, Pp=0.21
[60/153] Running simulation for invasion probabilities: Pr=0.21, Ps=0.63, Pp=0.16
[61/153] Running simulation for invasion probabilities: Pr=0.21, Ps=0.68, Pp=0.11
[62/153] Running simulation for invasion probabilities: Pr=0.21, Ps=0.74, Pp=0.05
[63/153] Running simulation for invasion probabilities: Pr=0.26, Ps=0.05, Pp=0.68
[64/153] Running simulation for invasion probabilities: Pr=0.26, Ps=0.11, Pp=0.63
[65/153] Running simulation for invasion probabilities: Pr=0.26, Ps=0.16, Pp=0.58
[66/153] Running simulation for invasion probabilities: Pr=0.26, Ps=0.21, Pp=0.53
[67/153] Running simulation for invasion probabilities: Pr=0.26, Ps=0.26, Pp=0.47
[68/153] Running simulation for invasion probabilities: Pr=0.26, Ps=0.32, Pp=0.42
[69/153] Running simulation for invasion probabilities: Pr=0.26, Ps=0.37, Pp=0.37
[70/153] Running simulation for invasion probabilities: Pr=0.26, Ps=0.42, Pp=0.32
[71/153] Running simulation for invasion probabilities: Pr=0.26, Ps=0.47, Pp=0.26
[72/153] Running simulation for invasion probabilities: Pr=0.26, Ps=0.53, Pp=0.21
[73/153] Running simulation for invasion probabilities: Pr=0.26, Ps=0.58, Pp=0.16
[74/153] Running simulation for invasion probabilities: Pr=0.26, Ps=0.63, Pp=0.11
[75/153] Running simulation for invasion probabilities: Pr=0.26, Ps=0.68, Pp=0.05
[76/153] Running simulation for invasion probabilities: Pr=0.32, Ps=0.05, Pp=0.63
[77/153] Running simulation for invasion probabilities: Pr=0.32, Ps=0.11, Pp=0.58
[78/153] Running simulation for invasion probabilities: Pr=0.32, Ps=0.16, Pp=0.53
[79/153] Running simulation for invasion probabilities: Pr=0.32, Ps=0.21, Pp=0.47
[80/153] Running simulation for invasion probabilities: Pr=0.32, Ps=0.26, Pp=0.42
[81/153] Running simulation for invasion probabilities: Pr=0.32, Ps=0.32, Pp=0.37
[82/153] Running simulation for invasion probabilities: Pr=0.32, Ps=0.37, Pp=0.32
[83/153] Running simulation for invasion probabilities: Pr=0.32, Ps=0.42, Pp=0.26
[84/153] Running simulation for invasion probabilities: Pr=0.32, Ps=0.47, Pp=0.21
[85/153] Running simulation for invasion probabilities: Pr=0.32, Ps=0.53, Pp=0.16
[86/153] Running simulation for invasion probabilities: Pr=0.32, Ps=0.58, Pp=0.11
[87/153] Running simulation for invasion probabilities: Pr=0.32, Ps=0.63, Pp=0.05
[88/153] Running simulation for invasion probabilities: Pr=0.37, Ps=0.05, Pp=0.58
[89/153] Running simulation for invasion probabilities: Pr=0.37, Ps=0.11, Pp=0.53
[90/153] Running simulation for invasion probabilities: Pr=0.37, Ps=0.16, Pp=0.47
[91/153] Running simulation for invasion probabilities: Pr=0.37, Ps=0.21, Pp=0.42
[92/153] Running simulation for invasion probabilities: Pr=0.37, Ps=0.26, Pp=0.37
[93/153] Running simulation for invasion probabilities: Pr=0.37, Ps=0.32, Pp=0.32
[94/153] Running simulation for invasion probabilities: Pr=0.37, Ps=0.37, Pp=0.26
[95/153] Running simulation for invasion probabilities: Pr=0.37, Ps=0.42, Pp=0.21
[96/153] Running simulation for invasion probabilities: Pr=0.37, Ps=0.47, Pp=0.16
[97/153] Running simulation for invasion probabilities: Pr=0.37, Ps=0.53, Pp=0.11
[98/153] Running simulation for invasion probabilities: Pr=0.37, Ps=0.58, Pp=0.05
[99/153] Running simulation for invasion probabilities: Pr=0.42, Ps=0.05, Pp=0.53
[100/153] Running simulation for invasion probabilities: Pr=0.42, Ps=0.11, Pp=0.47
[101/153] Running simulation for invasion probabilities: Pr=0.42, Ps=0.16, Pp=0.42
[102/153] Running simulation for invasion probabilities: Pr=0.42, Ps=0.21, Pp=0.37
[103/153] Running simulation for invasion probabilities: Pr=0.42, Ps=0.26, Pp=0.32
[104/153] Running simulation for invasion probabilities: Pr=0.42, Ps=0.32, Pp=0.26
[105/153] Running simulation for invasion probabilities: Pr=0.42, Ps=0.37, Pp=0.21
[106/153] Running simulation for invasion probabilities: Pr=0.42, Ps=0.42, Pp=0.16
[107/153] Running simulation for invasion probabilities: Pr=0.42, Ps=0.47, Pp=0.11
[108/153] Running simulation for invasion probabilities: Pr=0.42, Ps=0.53, Pp=0.05
[109/153] Running simulation for invasion probabilities: Pr=0.47, Ps=0.05, Pp=0.47
[110/153] Running simulation for invasion probabilities: Pr=0.47, Ps=0.11, Pp=0.42
[111/153] Running simulation for invasion probabilities: Pr=0.47, Ps=0.16, Pp=0.37
[112/153] Running simulation for invasion probabilities: Pr=0.47, Ps=0.21, Pp=0.32
[113/153] Running simulation for invasion probabilities: Pr=0.47, Ps=0.26, Pp=0.26
[114/153] Running simulation for invasion probabilities: Pr=0.47, Ps=0.32, Pp=0.21
[115/153] Running simulation for invasion probabilities: Pr=0.47, Ps=0.37, Pp=0.16
[116/153] Running simulation for invasion probabilities: Pr=0.47, Ps=0.42, Pp=0.11
[117/153] Running simulation for invasion probabilities: Pr=0.47, Ps=0.47, Pp=0.05
[118/153] Running simulation for invasion probabilities: Pr=0.53, Ps=0.05, Pp=0.42
[119/153] Running simulation for invasion probabilities: Pr=0.53, Ps=0.11, Pp=0.37
[120/153] Running simulation for invasion probabilities: Pr=0.53, Ps=0.16, Pp=0.32
[121/153] Running simulation for invasion probabilities: Pr=0.53, Ps=0.21, Pp=0.26
[122/153] Running simulation for invasion probabilities: Pr=0.53, Ps=0.26, Pp=0.21
[123/153] Running simulation for invasion probabilities: Pr=0.53, Ps=0.32, Pp=0.16
[124/153] Running simulation for invasion probabilities: Pr=0.53, Ps=0.37, Pp=0.11
[125/153] Running simulation for invasion probabilities: Pr=0.53, Ps=0.42, Pp=0.05
[126/153] Running simulation for invasion probabilities: Pr=0.58, Ps=0.05, Pp=0.37
[127/153] Running simulation for invasion probabilities: Pr=0.58, Ps=0.11, Pp=0.32
[128/153] Running simulation for invasion probabilities: Pr=0.58, Ps=0.16, Pp=0.26
[129/153] Running simulation for invasion probabilities: Pr=0.58, Ps=0.21, Pp=0.21
[130/153] Running simulation for invasion probabilities: Pr=0.58, Ps=0.26, Pp=0.16
[131/153] Running simulation for invasion probabilities: Pr=0.58, Ps=0.32, Pp=0.11
[132/153] Running simulation for invasion probabilities: Pr=0.58, Ps=0.37, Pp=0.05
[133/153] Running simulation for invasion probabilities: Pr=0.63, Ps=0.05, Pp=0.32
[134/153] Running simulation for invasion probabilities: Pr=0.63, Ps=0.11, Pp=0.26
[135/153] Running simulation for invasion probabilities: Pr=0.63, Ps=0.16, Pp=0.21
[136/153] Running simulation for invasion probabilities: Pr=0.63, Ps=0.21, Pp=0.16
[137/153] Running simulation for invasion probabilities: Pr=0.63, Ps=0.26, Pp=0.11
[138/153] Running simulation for invasion probabilities: Pr=0.63, Ps=0.32, Pp=0.05
[139/153] Running simulation for invasion probabilities: Pr=0.68, Ps=0.05, Pp=0.26
[140/153] Running simulation for invasion probabilities: Pr=0.68, Ps=0.11, Pp=0.21
[141/153] Running simulation for invasion probabilities: Pr=0.68, Ps=0.16, Pp=0.16
[142/153] Running simulation for invasion probabilities: Pr=0.68, Ps=0.21, Pp=0.11
[143/153] Running simulation for invasion probabilities: Pr=0.68, Ps=0.26, Pp=0.05
[144/153] Running simulation for invasion probabilities: Pr=0.74, Ps=0.05, Pp=0.21
[145/153] Running simulation for invasion probabilities: Pr=0.74, Ps=0.11, Pp=0.16
[146/153] Running simulation for invasion probabilities: Pr=0.74, Ps=0.16, Pp=0.11
[147/153] Running simulation for invasion probabilities: Pr=0.74, Ps=0.21, Pp=0.05
[148/153] Running simulation for invasion probabilities: Pr=0.79, Ps=0.05, Pp=0.16
[149/153] Running simulation for invasion probabilities: Pr=0.79, Ps=0.11, Pp=0.11
[150/153] Running simulation for invasion probabilities: Pr=0.79, Ps=0.16, Pp=0.05
[151/153] Running simulation for invasion probabilities: Pr=0.84, Ps=0.05, Pp=0.11
[152/153] Running simulation for invasion probabilities: Pr=0.84, Ps=0.11, Pp=0.05
[153/153] Running simulation for invasion probabilities: Pr=0.89, Ps=0.05, Pp=0.05</code></pre>
</div>
</div>
<p>Plotting the surviving species on a ternary plot:</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.scatter_ternary(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    pd.DataFrame(I, columns<span class="op">=</span>[<span class="st">'$P_r$'</span>, <span class="st">'$P_s$'</span>, <span class="st">'$P_p$'</span>]),</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    a<span class="op">=</span><span class="st">"$P_p$"</span>,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    b<span class="op">=</span><span class="st">"$P_r$"</span>,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    c<span class="op">=</span><span class="st">"$P_s$"</span>,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    size_max<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="ss">f"Surviving species after </span><span class="sc">{</span>EPOCHS<span class="sc">}</span><span class="ss"> epochs&lt;br&gt;N=</span><span class="sc">{</span>N<span class="sc">}</span><span class="ss">, population densities initialized with their value at the fixed point"</span>,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    color <span class="op">=</span> winners,</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    color_discrete_map<span class="op">=</span>{<span class="st">'None'</span>: <span class="st">'black'</span>, <span class="st">'Rock'</span>: <span class="st">'red'</span>, <span class="st">'Scissors'</span>: <span class="st">'purple'</span>, <span class="st">'Paper'</span>: <span class="st">'gold'</span>}</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>fig.update_layout(legend_title_text<span class="op">=</span><span class="st">'Winner'</span>)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>fig.show(<span class="st">'png'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="long_range_simulations_files/figure-html/cell-9-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>The weakest competitor is most likely to survive.</p>
</section>
<section id="large-population-size" class="level3">
<h3 class="anchored" data-anchor-id="large-population-size">1.2. Large population size</h3>
<p>In the limit of large <span class="math inline">\(N\)</span>, the rate of change of species population density is given by the mean-field equations:</p>
<span class="math display">\[\begin{cases}
\frac{\partial n_r}{\partial t}=n_r\cdot (n_s\cdot P_r - n_p \cdot P_p)\\
\frac{\partial n_s}{\partial t}=n_s\cdot (n_p\cdot P_s - n_r \cdot P_r)\\
\frac{\partial n_p}{\partial t}=n_p\cdot (n_r\cdot P_p - n_s \cdot P_s)\\
\end{cases}\]</span>
<p>where the system dynamic is approximated considering the average effect of interactions rather than tracking every specific interaction (hence the term mean-field).</p>
<p>For example, in the first equation, <span class="math inline">\(n_s\cdot P_r\)</span> represents the rate at which the rock species increases due to its successful invasion of the scissors species, while <span class="math inline">\(n_p\cdot P_p\)</span> represents the rate at which the rock species decreases due to the successful invasion of the paper species. The difference between these terms is then multiplied by the population density of the rock species to ensure that the rate of change is properly scaled according to the availability of species r. Similar considerations apply to the other equations.</p>
<p>Note that in these equations a unit of time <span class="math inline">\(t\)</span> is <span class="math inline">\(N\)</span> individual time-steps, which we refer to as an epoch.</p>
<p>To transform continuous-time differential equation into a discrete-time recurrence relation that describes the evolution of the population over time, we observe that the derivative <span class="math inline">\(\frac{\partial n_r}{\partial t}\)</span> can be approximated by the difference between the population densities at consecutive time steps</p>
<p><span class="math display">\[\frac{\partial n_r}{\partial t}=\frac{n_r[t+1]-n_r[t]}{\Delta_t}\]</span></p>
<p>and solving for <span class="math inline">\(n_r[t+1]\)</span> we obtain</p>
<p><span class="math display">\[n_r[t+\Delta_t]=n_r[t] + \Delta_t \cdot n_r[t](n_s[t]P_r - n_p[t] P_p)\]</span></p>
<p>Applying the same reasoning to the other equations, we obtain the following system of recurrence equations:</p>
<span class="math display">\[\begin{cases}
n_r[t+\Delta_t]=n_r[t] + \Delta_t \cdot n_r[t](n_s[t]P_r - n_p[t] P_p)\\
n_s[t+\Delta_t]=n_s[t] + \Delta_t \cdot n_s[t](n_p[t]P_s - n_r[t] P_r)\\
n_p[t+\Delta_t]=n_p[t] + \Delta_t \cdot n_p[t](n_r[t]P_p - n_s[t] P_s)\\
\end{cases}\]</span>
<p>Defining a function to simulate the evolution of the system of recurrent equations under the large <span class="math inline">\(N\)</span> assumption:</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> simulate_large_N(Pr, Ps, Pp, nr_init, ns_init, delta_t<span class="op">=</span><span class="fl">0.001</span>, epochs<span class="op">=</span><span class="dv">1000</span>):</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">'''</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Simulate the evolution of a population of three species over time using </span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co">    the recurrence relations under the large N assumption.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co">    Pr : float</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co">        The probability that a species of type r invades a species of type s.</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="co">    Ps : float</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co">        The probability that a species of type s invades a species of type p.</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="co">    Pp : float</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="co">        The probability that a species of type p invades a species of type r.</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="co">    nr_init : float</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="co">        The initial proportion of species r in the population.</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="co">    ns_init : float</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="co">        The initial proportion of species s in the population.</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="co">    delta_t : float</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="co">        The time step size.</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="co">    epochs : int</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a><span class="co">        The number of time units to simulate.</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="co">    '''</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> check_P(P):</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> P <span class="op">&lt;</span> <span class="dv">0</span> <span class="kw">or</span> P <span class="op">&gt;</span> <span class="dv">1</span>:</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">'Pr, Ps and Pp must be between 0 and 1'</span>)</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>    check_P(Pr)</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>    check_P(Ps)</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>    check_P(Pp)</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> nr_init <span class="op">+</span> ns_init <span class="op">&gt;</span> <span class="dv">1</span>:</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">'Initial species proportions must be less than 1'</span>)</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> epochs <span class="op">&lt;</span> <span class="dv">1</span>:</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">'Number of steps must be at least 1'</span>)</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>    nr <span class="op">=</span> []</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>    ns <span class="op">=</span> []</span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>    np <span class="op">=</span> []</span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>    nr.append(nr_init)</span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>    ns.append(ns_init)</span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>    np.append(<span class="dv">1</span> <span class="op">-</span> nr_init <span class="op">-</span> ns_init)</span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, epochs<span class="op">-</span><span class="dv">1</span>):</span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>        nr.append(nr[<span class="op">-</span><span class="dv">1</span>] <span class="op">+</span> nr[<span class="op">-</span><span class="dv">1</span>]<span class="op">*</span>delta_t<span class="op">*</span>(ns[<span class="op">-</span><span class="dv">1</span>]<span class="op">*</span>Pr <span class="op">-</span> np[<span class="op">-</span><span class="dv">1</span>]<span class="op">*</span>Pp))</span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>        ns.append(ns[<span class="op">-</span><span class="dv">1</span>] <span class="op">+</span> ns[<span class="op">-</span><span class="dv">1</span>]<span class="op">*</span>delta_t<span class="op">*</span>(np[<span class="op">-</span><span class="dv">1</span>]<span class="op">*</span>Ps <span class="op">-</span> nr[<span class="op">-</span><span class="dv">2</span>]<span class="op">*</span>Pr)) <span class="co"># use nr from the previous time step</span></span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>        np.append(<span class="dv">1</span> <span class="op">-</span> nr[<span class="op">-</span><span class="dv">1</span>] <span class="op">-</span> ns[<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>        <span class="co"># if two species go extinct, stop the simulation</span></span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">sum</span>([numpy.isclose(nr[<span class="op">-</span><span class="dv">1</span>], <span class="dv">0</span>, <span class="fl">1e-4</span>),</span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a>                numpy.isclose(ns[<span class="op">-</span><span class="dv">1</span>], <span class="dv">0</span>, <span class="fl">1e-4</span>),</span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a>                numpy.isclose(np[<span class="op">-</span><span class="dv">1</span>], <span class="dv">0</span>, <span class="fl">1e-4</span>)]) <span class="op">&gt;=</span> <span class="dv">2</span>:</span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.DataFrame({<span class="st">'$n_r$'</span>: nr, <span class="st">'$n_s$'</span>: ns, <span class="st">'$n_p$'</span>: np})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Trivial fixed points of the system are (<span class="math inline">\(n_r=0, n_s=0, n_p=1\)</span>), (<span class="math inline">\(n_r=0, n_s=1, n_p=0\)</span>) and (<span class="math inline">\(n_r=1, n_s=0, n_p=0\)</span>).</p>
<p>The non-trivial fixed point is obtained by setting the rates of change to zero:</p>
<span class="math display">\[\begin{cases}
\frac{\partial n_r}{\partial t}=n_r\cdot (n_s\cdot P_r - n_p \cdot P_p)=0 \implies n_p = \frac{n_s\cdot P_r}{P_p}&amp;\text{(1)}\\
\frac{\partial n_s}{\partial t}=n_s\cdot (n_p\cdot P_s - n_r \cdot P_r)=0 \implies n_r = \frac{n_p\cdot P_s}{P_r}&amp;\text{(2)}\\
n_r+n_s+n_p=1 \implies n_s = 1-n_p-n_r&amp;\text{(3)}\\
\end{cases}\]</span>
<p><span class="math display">\[\implies\]</span></p>
<span class="math display">\[\begin{cases}
n_r = \frac{n_s \cdot \cancel{P_r}\cdot P_s}{P_p\cdot \cancel{P_r}}&amp;\text{(4), substituting (1) into (2)}\\
n_s = 1-\frac{n_s\cdot P_r}{P_p}-nr&amp;\text{(5), substituting (1) into (3)}\\
\end{cases}\]</span>
<p><span class="math display">\[\implies\]</span></p>
<span class="math display">\[\begin{cases}
n_s=1-\frac{n_s\cdot P_r}{P_p}-\frac{n_s\cdot P_s}{P_p}\implies n_s=\frac{P_p}{P_p+P_r+P_s}&amp;\text{(6), substituting (4) into (5)}\\
n_p=\frac{n_s\cdot P_r}{P_p}=\frac{\cancel{P_p}\cdot P_r}{\cancel{P_p}\cdot (P_p+P_r+P_s)}=\frac{P_r}{P_p+P_r+P_s}&amp;\text{(7), substituting (6) into (1)}\\
n_r=\frac{n_p\cdot P_s}{P_r}=\frac{\cancel{P_r}\cdot P_s}{\cancel{P_r}\cdot (P_p+P_r+P_s)}=\frac{P_s}{P_p+P_r+P_s}&amp;\text{(8), substituting (7) into (2)}\\
\end{cases}\]</span>
<p>In the following, we will refer to the population density at the fixed point as <span class="math inline">\(R\)</span>, <span class="math inline">\(S\)</span> and <span class="math inline">\(P\)</span> for species <span class="math inline">\(r\)</span>, <span class="math inline">\(s\)</span> and <span class="math inline">\(p\)</span> respectively. The population densities at the fixed point are controlled by the invasion rate of the species they invade (the fixed point population of species <span class="math inline">\(r\)</span> depends on the invasion rate of species <span class="math inline">\(s\)</span>, the fixed point population of species <span class="math inline">\(s\)</span> depends on the invasion rate of species <span class="math inline">\(p\)</span> and the fixed point population of species <span class="math inline">\(p\)</span> depends on the invasion rate of species <span class="math inline">\(r\)</span>). As a consequence, the most aggressive species never has the highest fixed-point population. Moreover, if the invasion probabilities of two species are held steady, then a decrease in the competitive ability of the third leads to an increase in its fixed-point population. For example, if the invasion rate of species <span class="math inline">\(p\)</span> decreases, then the population at the fixed point of species <span class="math inline">\(s\)</span> decreases and since there are less <span class="math inline">\(s\)</span> individuals invading species <span class="math inline">\(r\)</span>, the population of <span class="math inline">\(r\)</span> increases.</p>
<p>Simulating the evolution of the system of recurrent equations under the large N assumption with <span class="math inline">\(P_r = 0.2\)</span>, <span class="math inline">\(P_s = 0.5\)</span>, <span class="math inline">\(P_p = 0.3\)</span> initialized with population densities close to the fixed point (<span class="math inline">\(n_r=0.5\)</span>, <span class="math inline">\(n_s=0.3\)</span>, <span class="math inline">\(n_p=0.2\)</span>):</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>fp_large_N_df <span class="op">=</span> simulate_large_N(Pr<span class="op">=</span><span class="fl">0.2</span>, Ps<span class="op">=</span><span class="fl">0.5</span>, Pp<span class="op">=</span><span class="fl">0.3</span>, nr_init<span class="op">=</span><span class="fl">0.5</span>, ns_init<span class="op">=</span><span class="fl">0.3</span>, epochs<span class="op">=</span><span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Plotting the evolution of the system:</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>line_plot_species_evolution(</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    fp_large_N_df,</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">'Large N assumption, $P_r=0.2$, $P_s=0.5$, $P_p=0.3$, $n_r^0$=0.5, $n_s^0$=0.3'</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="long_range_simulations_files/figure-html/cell-12-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Initializing the population densities equal to the fixed point (<span class="math inline">\(n_r=1/3\)</span>, <span class="math inline">\(n_s=1/3\)</span>, <span class="math inline">\(n_p=1/3\)</span>), the system remains at the fixed point.</p>
<p>Simulating the evolution of the system under the large N assumption with <span class="math inline">\(P_r = 0.2\)</span>, <span class="math inline">\(P_s = 0.5\)</span>, <span class="math inline">\(P_p = 0.3\)</span>, initialized with equal population densities (<span class="math inline">\(n_r=1/3\)</span>, <span class="math inline">\(n_s=1/3\)</span>, <span class="math inline">\(n_p=1/3\)</span>) and using <span class="math inline">\(\Delta_t=1\)</span>:</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>eq_large_N_df <span class="op">=</span> simulate_large_N(Pr<span class="op">=</span><span class="fl">0.2</span>, Ps<span class="op">=</span><span class="fl">0.5</span>, Pp<span class="op">=</span><span class="fl">0.3</span>, nr_init<span class="op">=</span><span class="dv">1</span><span class="op">/</span><span class="dv">3</span>, ns_init<span class="op">=</span><span class="dv">1</span><span class="op">/</span><span class="dv">3</span>, delta_t<span class="op">=</span><span class="dv">1</span>, epochs<span class="op">=</span><span class="dv">1000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Plotting the evolution of the system:</p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>line_plot_species_evolution(</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    eq_large_N_df,</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">'Large N assumption, $P_r=0.2$, $P_s=0.5$, $P_p=0.3$, $n_r^0$=1/3, $n_s^0$=1/3'</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="long_range_simulations_files/figure-html/cell-14-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>phase_plot_species_evolution(</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    eq_large_N_df,</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">'Phase portait</span><span class="ch">\n</span><span class="st">Large N assumption, $P_r=0.2$, $P_s=0.5$, $P_p=0.3$, $n_r^0$=1/3, $n_s^0$=1/3'</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="long_range_simulations_files/figure-html/cell-15-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>ternary_plot_species_evolution(</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    eq_large_N_df,</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="vs">r"$\text{Large N assumption, }P_r=0.2, P_s=0.5, P_p=0.3, n_r^0=1/3, n_s^0=1/3$"</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="long_range_simulations_files/figure-html/cell-16-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Simulating the evolution of the system with <span class="math inline">\(\Delta_t=0.01\)</span> to increase accuracy:</p>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>eq_large_N_df <span class="op">=</span> simulate_large_N(Pr<span class="op">=</span><span class="fl">0.2</span>, Ps<span class="op">=</span><span class="fl">0.5</span>, Pp<span class="op">=</span><span class="fl">0.3</span>, nr_init<span class="op">=</span><span class="dv">1</span><span class="op">/</span><span class="dv">3</span>, ns_init<span class="op">=</span><span class="dv">1</span><span class="op">/</span><span class="dv">3</span>, delta_t<span class="op">=</span><span class="fl">0.01</span>, epochs<span class="op">=</span><span class="dv">100000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Plotting the evolution of the system:</p>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>line_plot_species_evolution(</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    eq_large_N_df,</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">'Large N assumption, $P_r=0.2$, $P_s=0.5$, $P_p=0.3$, $n_r^0$=1/3, $n_s^0$=1/3'</span>,</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    show_markers<span class="op">=</span><span class="va">False</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="long_range_simulations_files/figure-html/cell-18-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>ternary_plot_species_evolution(</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    eq_large_N_df,</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="vs">r"$\text{Large N assumption, }P_r=0.2, P_s=0.5, P_p=0.3, n_r^0=1/3, n_s^0=1/3$"</span>,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    show_markers<span class="op">=</span><span class="va">False</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="long_range_simulations_files/figure-html/cell-19-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>In the limit that the total number of sites is large the populations move along a periodic orbit around the fixed point.</p>
</section>
</section>
<section id="continuous-time-model" class="level2">
<h2 class="anchored" data-anchor-id="continuous-time-model">2. Continuous-time model</h2>
<p>To enhance accuracy, we simulate the system’s evolution by solving the differential equations that define it.</p>
<p>The <code>odeint</code> method from <code>scipy.integrate</code> solves a system of ordinary differential equations using lsoda from the FORTRAN library odepack. This library uses the Adams/BDF method with automatic stiffness detection and switching.</p>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ODE_solver(t, P, x0):</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">'''</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Solve the initial value problem for the ODE system.</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co">    '''</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> RSP(x, t, P):</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>        nr <span class="op">=</span> x[<span class="dv">0</span>]</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>        Pr <span class="op">=</span> P[<span class="dv">0</span>]</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>        ns <span class="op">=</span> x[<span class="dv">1</span>]</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>        Ps <span class="op">=</span> P[<span class="dv">1</span>]</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>        np <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> nr <span class="op">-</span> ns</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>        Pp <span class="op">=</span> P[<span class="dv">2</span>]</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>        d_nr_dt <span class="op">=</span> nr<span class="op">*</span>(ns<span class="op">*</span>Pr <span class="op">-</span> np<span class="op">*</span>Pp)</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>        d_ns_dt <span class="op">=</span> ns<span class="op">*</span>(np<span class="op">*</span>Ps <span class="op">-</span> nr<span class="op">*</span>Pr)</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> [d_nr_dt, d_ns_dt]</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> odeint(RSP, x0, t, args<span class="op">=</span>(P,))</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>    results_df <span class="op">=</span> pd.DataFrame(y, columns<span class="op">=</span>[<span class="st">'$n_r$'</span>, <span class="st">'$n_s$'</span>])</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>    results_df[<span class="st">'$n_p$'</span>] <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> results_df[<span class="st">'$n_r$'</span>] <span class="op">-</span> results_df[<span class="st">'$n_s$'</span>]</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> results_df</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> simulate_continuous(t, Pr, Ps, Pp, nr_init, ns_init):</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">'''</span></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a><span class="co">    Simulate the evolution of a population of three species over time in the</span></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a><span class="co">    continuous setting, solving the initial value problem for the ODE system.</span></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a><span class="co">    '''</span></span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> nr_init <span class="op">+</span> ns_init <span class="op">&gt;</span> <span class="dv">1</span>:</span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">'Initial species proportions must be less than 1'</span>)</span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> check_P(P):</span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> P <span class="op">&lt;</span> <span class="dv">0</span> <span class="kw">or</span> P <span class="op">&gt;</span> <span class="dv">1</span>:</span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">'P_r, P_s and P_p must be between 0 and 1'</span>)</span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>    check_P(Pr)</span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>    check_P(Ps)</span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>    check_P(Pp)</span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a>    P <span class="op">=</span> [Pr, Ps, Pp]</span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a>    x0 <span class="op">=</span> [nr_init, ns_init]</span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a>    s <span class="op">=</span> ODE_solver(t, P, x0)</span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> s</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Simulating the evolution of the system in the continuous setting with <span class="math inline">\(P_r = 0.2\)</span>, <span class="math inline">\(P_s = 0.5\)</span>, <span class="math inline">\(P_p = 0.3\)</span> initialized with population densities close to the fixed point (<span class="math inline">\(n_r=0.5\)</span>, <span class="math inline">\(n_s=0.3\)</span>, <span class="math inline">\(n_p=0.2\)</span>):</p>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>fp_continuous_df <span class="op">=</span> simulate_continuous(t<span class="op">=</span>np.linspace(<span class="dv">0</span>,<span class="dv">100</span>,<span class="dv">101</span>), Pr<span class="op">=</span><span class="fl">0.2</span>, Ps<span class="op">=</span><span class="fl">0.5</span>, Pp<span class="op">=</span><span class="fl">0.3</span>, nr_init<span class="op">=</span><span class="fl">0.5</span>, ns_init<span class="op">=</span><span class="fl">0.3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Plotting the evolution of the system:</p>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>line_plot_species_evolution(</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    fp_continuous_df,</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">'$P_r=0.2$, $P_s=0.5$, $P_p=0.3$, $n_r^0$=0.5, $n_s^0$=0.3'</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="long_range_simulations_files/figure-html/cell-22-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>As in the discrete time setting, initializing the population densities equal to the fixed point (<span class="math inline">\(n_r=1/3\)</span>, <span class="math inline">\(n_s=1/3\)</span>, <span class="math inline">\(n_p=1/3\)</span>), the system remains at the fixed point.</p>
<p>Simulating the evolution of the system in the continuous setting with <span class="math inline">\(P_r = 0.2\)</span>, <span class="math inline">\(P_s = 0.5\)</span>, <span class="math inline">\(P_p = 0.3\)</span>, initialized with equal population densities (<span class="math inline">\(n_r=1/3\)</span>, <span class="math inline">\(n_s=1/3\)</span>, <span class="math inline">\(n_p=1/3\)</span>):</p>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>eq_continuous_df <span class="op">=</span> simulate_continuous(t<span class="op">=</span>np.linspace(<span class="dv">0</span>,<span class="dv">1000</span>,<span class="dv">1001</span>), Pr<span class="op">=</span><span class="fl">0.2</span>, Ps<span class="op">=</span><span class="fl">0.5</span>, Pp<span class="op">=</span><span class="fl">0.3</span>, nr_init<span class="op">=</span><span class="dv">1</span><span class="op">/</span><span class="dv">3</span>, ns_init<span class="op">=</span><span class="dv">1</span><span class="op">/</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Plottting the evolution of the system:</p>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>line_plot_species_evolution(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    eq_continuous_df,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">'$P_r=0.2$, $P_s=0.5$, $P_p=0.3$, $n_r^0$=1/3, $n_s^0$=1/3'</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="long_range_simulations_files/figure-html/cell-24-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>ternary_plot_species_evolution(</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    eq_continuous_df,</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="vs">r"$P_r=0.2, P_s=0.5, P_p=0.3, n_r^0=1/3, n_s^0=1/3$"</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="long_range_simulations_files/figure-html/cell-25-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Again, the populations move along a periodic orbit around the fixed point.</p>
<p>Performing simulations for different initial population densities and plotting the orbits on a ternary plot:</p>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> go.Figure()</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co"># iterating over initial proportions</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, init <span class="kw">in</span> <span class="bu">enumerate</span>([<span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="fl">0.4</span>]):</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># simulate the system</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> simulate_continuous(t<span class="op">=</span>np.linspace(<span class="dv">0</span>,<span class="dv">100</span>,<span class="dv">101</span>), Pr<span class="op">=</span><span class="fl">0.2</span>, Ps<span class="op">=</span><span class="fl">0.5</span>, Pp<span class="op">=</span><span class="fl">0.3</span>, nr_init<span class="op">=</span>init, ns_init<span class="op">=</span>init)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># plot the trajectory</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    fig.add_trace(go.Scatterternary(</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>        mode<span class="op">=</span><span class="st">'lines'</span>,</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>        a<span class="op">=</span>df[<span class="st">'$n_p$'</span>],</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>        b<span class="op">=</span>df[<span class="st">'$n_r$'</span>],</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>        c<span class="op">=</span>df[<span class="st">'$n_s$'</span>],</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>        name<span class="op">=</span><span class="ss">f'$n_r^0=</span><span class="sc">{</span>init<span class="sc">}</span><span class="ss">, n_s^0=</span><span class="sc">{</span>init<span class="sc">}</span><span class="ss">$'</span>,</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>        line<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span>px.colors.qualitative.Dark2[i], width<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>fig.update_layout(</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>    ternary<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>        aaxis_title<span class="op">=</span><span class="st">'$n_p$'</span>,</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>        baxis_title<span class="op">=</span><span class="st">'$n_r$'</span>,</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>        caxis_title<span class="op">=</span><span class="st">'$n_s$'</span></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="vs">r"$\text{Periodic orbits around the non-trivial fixed point}\\P_r=0.2, P_s=0.5, P_p=0.3$"</span>,</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>    legend<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span><span class="st">'Initial conditions'</span></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>fig.show(<span class="st">'png'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="long_range_simulations_files/figure-html/cell-26-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>The quantity <span class="math inline">\(\lambda=(\frac{n_r}{R})^R(\frac{n_s}{S})^S(\frac{n_p}{P})^P\)</span> is invariant along each orbit, with <span class="math inline">\(\lambda=1\)</span> when the populations are at the fixed point and <span class="math inline">\(\lambda=0\)</span> when one or more of the species become extinct.</p>
<p>Defining a function to calculate the invariant:</p>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_lambda(df, Pr, Ps, Pp):</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'lambda'</span>] <span class="op">=</span> (df[<span class="st">'$n_r$'</span>]<span class="op">/</span><span class="fl">0.5</span>)<span class="op">**</span>Ps<span class="op">*</span>(df[<span class="st">'$n_s$'</span>]<span class="op">/</span>Pp)<span class="op">**</span>Pp<span class="op">*</span>(df[<span class="st">'$n_p$'</span>]<span class="op">/</span>Pr)<span class="op">**</span>Pr</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Computing and plotting the orbit invariant:</p>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>eq_continuous_df <span class="op">=</span> compute_lambda(eq_continuous_df, Pr<span class="op">=</span><span class="fl">0.2</span>, Ps<span class="op">=</span><span class="fl">0.5</span>, Pp<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>eq_continuous_df[<span class="st">'lambda'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="bu">round</span>(x, <span class="dv">2</span>)).plot(</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">4</span>),</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">'lambda'</span>,</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    style<span class="op">=</span><span class="st">'-'</span>, label<span class="op">=</span><span class="st">'$\lambda$'</span>,</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">'Orbit invariant</span><span class="ch">\n</span><span class="st">$P_r=0.2$, $P_s=0.5$, $P_p=0.3$, $n_r^0=1/3$, $n_s^0=1/3$'</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>plt.legend()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<pre><code>&lt;matplotlib.legend.Legend at 0x2a1434750&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="long_range_simulations_files/figure-html/cell-28-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>results_df <span class="op">=</span> simulate_continuous(t<span class="op">=</span>np.linspace(<span class="dv">0</span>,<span class="dv">500</span>,<span class="dv">501</span>), Pr<span class="op">=</span><span class="fl">0.1</span>, Ps<span class="op">=</span><span class="fl">0.1</span>, Pp<span class="op">=</span><span class="fl">0.8</span>, nr_init<span class="op">=</span><span class="dv">1</span><span class="op">/</span><span class="dv">3</span>, ns_init<span class="op">=</span><span class="dv">1</span><span class="op">/</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>line_plot_species_evolution(</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>    results_df,</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">'$P_r=0.1$, $P_s=0.1$, $P_p=0.8$, $n_r^0$=1/3, $n_s^0$=1/3'</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="long_range_simulations_files/figure-html/cell-30-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="stochastic-simulation-of-chemical-reactions" class="level2">
<h2 class="anchored" data-anchor-id="stochastic-simulation-of-chemical-reactions">3. Stochastic simulation of chemical reactions</h2>
<p>While ODEs are deterministic and do not account for fluctuations in population densities, stochastic simulation methods offer greater accuracy, particularly when analyzing reaction systems with small quantities of molecules.</p>
<p>To perform stochastic simulations, we need to translate the ODE system</p>
<span class="math display">\[\begin{cases}
\frac{\partial n_r}{\partial t}=\textcolor{violet}{n_r\cdot n_s\cdot P_r} - \textcolor{gold}{n_r \cdot n_p \cdot P_p}\\
\frac{\partial n_s}{\partial t}=\textcolor{cyan}{n_s\cdot n_p\cdot P_s} - \textcolor{orange}{n_s\cdot n_r \cdot P_r}\\
\frac{\partial n_p}{\partial t}=\textcolor{palegreen}{n_p\cdot n_r\cdot P_p} - \textcolor{red}{n_p\cdot n_s \cdot P_s}\\
\end{cases}\]</span>
<p>into a system of chemical reactions, by constructing one reaction for each term of the equations as follows</p>
<span class="math display">\[\begin{cases}
\textcolor{violet}{R + S \xrightarrow{P_r} S + 2R}\\
\textcolor{gold}{R + P \xrightarrow{P_p} P}\\
\textcolor{cyan}{S + P \xrightarrow{P_s} P + 2S}\\
\textcolor{orange}{S + R \xrightarrow{P_r} R}\\
\textcolor{palegreen}{P + R \xrightarrow{P_p} R + 2P}\\
\textcolor{red}{P + S \xrightarrow{P_s} S}\\
\end{cases}\]</span>
<p>where we use the capital letters <span class="math inline">\(R, S, P\)</span> to denote the species rock, scissors and paper respectively.</p>
<p>We can simplify the system by noting, for example, that the terms <span class="math inline">\(\textcolor{violet}{n_r\cdot n_s\cdot P_r}\)</span> and <span class="math inline">\(\textcolor{orange}{n_s\cdot n_r \cdot P_r}\)</span> can be represented by the same reaction. Hence we can combine them into a single reaction and do the same for the other similar terms, obtaining the following system</p>
<span class="math display">\[\begin{cases}
R + S \xrightarrow{P_r} 2R\\
S + P \xrightarrow{P_s} 2S\\
P + R \xrightarrow{P_p} 2P\\
\end{cases}\]</span>
<p>The simplified system clearly represents the interactions between the species: rocks beat scissors with probability <span class="math inline">\(P_r\)</span>, scissors beat paper with probability <span class="math inline">\(P_s\)</span> and paper beats rock with probability <span class="math inline">\(P_p\)</span>.</p>
<p>We will use StochPy, a Python package for stochastic simulation of chemical reactions:</p>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> stochpy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
#######################################################################
#                                                                     #
#            Welcome to the interactive StochPy environment           #
#                                                                     #
#######################################################################
#  StochPy: Stochastic modeling in Python                             #
#  http://stochpy.sourceforge.net                                     #
#  Copyright(C) T.R Maarleveld, B.G. Olivier, F.J Bruggeman 2010-2015 #
#  DOI: 10.1371/journal.pone.0079345                                  #
#  Email: tmd200@users.sourceforge.net                                #
#  VU University, Amsterdam, Netherlands                              #
#  Centrum Wiskunde Informatica, Amsterdam, Netherlands               #
#  StochPy is distributed under the BSD licence.                      #
#######################################################################

Version 2.4.0
Output Directory: /Users/irenetesta/Stochpy
Model Directory: /Users/irenetesta/Stochpy/pscmodels</code></pre>
</div>
</div>
<p>StochPy uses the <a href="https://stochpy.sourceforge.net/html/inputfile_doc.html#pysces-inputfile">PySCeS MDL</a>, an ASCII text based input file to describe a system in terms of it’s stoichiometry, kinetics, compartments and parameters. We defined the system using such format and saved it in the file <code>../long_range_models/RSP_model_reduced.psc</code>:</p>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>cat ..<span class="op">/</span>long_range_models<span class="op">/</span>RSP_model_reduced.psc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Rock Scissors Paper model

# R + S  --&gt; 2R, Pr
# P + R --&gt; 2P, Pp
# S + P --&gt; 2S, Ps

R1:
    R + S &gt; R + R
    R*S*Pr

R2:
    S + P &gt; S + S
    S*P*Ps

R3: 
    P + R &gt; P + P
    P*R*Pp

# Parameters
Pr = 0.2
Ps = 0.5
Pp = 0.3

# Init Values
R = 33
S = 33
P = 33</code></pre>
</div>
</div>
<p>Loading the model:</p>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>smod <span class="op">=</span> stochpy.SSA(IsQuiet<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>smod.Model(model_file<span class="op">=</span><span class="st">"RSP_model_reduced.psc"</span>,<span class="bu">dir</span><span class="op">=</span><span class="st">"../long_range_models/"</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>smod.ShowSpecies()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Info: Direct method is selected to perform stochastic simulations.
Parsing file: /Users/irenetesta/Stochpy/pscmodels/ImmigrationDeath.psc
Info: No reagents have been fixed
Parsing file: ../long_range_models/RSP_model_reduced.psc
Info: No reagents have been fixed
['R', 'S', 'P']</code></pre>
</div>
</div>
<p>Setting initial conditions (close to the fixed point) and parameters, using a high number of copies for each species to approximate the deterministic behavior of the system:</p>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>smod.ChangeParameter(<span class="st">"Pr"</span>, <span class="fl">0.2</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>smod.ChangeParameter(<span class="st">"Ps"</span>, <span class="fl">0.5</span>)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>smod.ChangeParameter(<span class="st">"Pp"</span>, <span class="fl">0.3</span>)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>smod.ChangeInitialSpeciesCopyNumber(<span class="st">"R"</span>, <span class="dv">50000</span>)</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>smod.ChangeInitialSpeciesCopyNumber(<span class="st">"S"</span>, <span class="dv">30000</span>)</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>smod.ChangeInitialSpeciesCopyNumber(<span class="st">"P"</span>, <span class="dv">20000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The method to perform a stochastic simulation is <code>DoStochSim</code>:</p>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="bu">help</span>(smod.DoStochSim)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Help on method DoStochSim in module stochpy.modules.StochSim:

DoStochSim(end=False, mode=False, method=False, trajectories=False, epsilon=0.03, IsTrackPropensities=False, rate_selection=None, species_selection=None, IsOnlyLastTimepoint=False, critical_reactions=[], reaction_orders=False, species_HORs=False, species_max_influence=False, quiet=False) method of stochpy.modules.StochSim.SSA instance
    Run a stochastic simulation for until `end` is reached. This can be either time steps or end time (which could be a *HUGE* number of steps).
    
    Input:
     - *end* [default=1000] (float) simulation end (steps or time)
     - *mode* [default='steps'] (string) simulation mode, can be one of: ['steps','time']
     - *method* [default='Direct'] (string) stochastic algorithm ['Direct', 'FRM', 'NRM', 'TauLeap']
     - *trajectories* [default = 1] (integer)
     - *epsilon* [default = 0.03] (float) parameter for the tau-leap method
     - *IsTrackPropensities* [default = False]
     - *rate_selection* [default = None] (list) of names of rates to store. This saves memory space and prevents Memory Errors when propensities propensities are tracked
     - *species_selection* [default = None] (list) of names of species to store. This saves memory space and prevents Memory Errors (occurring at ~15 species).
     - *IsOnlyLastTimepoint* [default = False] (boolean)
     - *critical_reactions* [default = [] ] (list) ONLY for the tau-leaping method where the user can pre-define reactions that are "critical". Critical reactions can fire only once per time step.
     - *reaction_orders* [default = [] (list) ONLY for the tau-leaping method 
     - *species_HORs* [default = []  (list) ONLY for the tau-leaping method 
     - *species_max_influence* [default = []]  (list) ONLY for the tau-leaping method 
     - *quiet* [default = False] suppress print statements
</code></pre>
</div>
</div>
<p>In the following, we will only use the Direct method as its variants are designed to reduce computational costs, which is not a concern for the simulations we will perform.</p>
<p>Performing a stochastic simulation using default parameters:</p>
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>smod.DoStochSim()</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>smod.PlotSpeciesTimeSeries(colors<span class="op">=</span>[<span class="st">"tab:red"</span>, <span class="st">"purple"</span>, <span class="st">"gold"</span>], xlabel<span class="op">=</span><span class="st">"Steps"</span>)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>stochpy.plt.title(<span class="st">"$P_r=0.2$, $P_s=0.5$, $P_p=0.3$, $R=50000$, $S=30000$, $P=20000$"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Info: 1 trajectory is generated
simulation done!               
Info: Number of time steps 1000 End time 1.0951329075756742e-06
Info: Simulation time 0.01658</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/irenetesta/anaconda3/envs/stochpy/lib/python3.11/site-packages/stochpy/modules/Analysis.py:479: UserWarning:

linestyle is redundantly defined by the 'linestyle' keyword argument and the fmt string "" (-&gt; linestyle='-'). The keyword argument will take precedence.
</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="long_range_simulations_files/figure-html/cell-36-output-3.png" class="img-fluid"></p>
</div>
</div>
<p>As in deterministic simulations, using a high number of molecules and initializing species copy number close to the fixed point, ensures that the system remains at the fixed point.</p>
<p>Performing a stochastic simulation with a lower number of molecules and tracking reaction propensities:</p>
<div class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>smod.ChangeInitialSpeciesCopyNumber(<span class="st">"R"</span>, <span class="dv">50</span>)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>smod.ChangeInitialSpeciesCopyNumber(<span class="st">"S"</span>, <span class="dv">30</span>)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>smod.ChangeInitialSpeciesCopyNumber(<span class="st">"P"</span>, <span class="dv">20</span>)</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>smod.DoStochSim(end<span class="op">=</span><span class="dv">10000</span>, IsTrackPropensities<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>fp_stoch_df <span class="op">=</span> pd.DataFrame(smod.data_stochsim.species, columns<span class="op">=</span>[<span class="st">'R'</span>, <span class="st">'S'</span>, <span class="st">'P'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Info: 1 trajectory is generated
simulation done!               
Info: Number of time steps 1928 End time 2.519492477708811
Info: Simulation time 0.02666</code></pre>
</div>
</div>
<p>Plotting the evolution of the system:</p>
<div class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>line_plot_species_evolution(</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>    fp_stoch_df,</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">"$P_r=0.2$, $P_s=0.5$, $P_p=0.3$, $R=50$, $S=30$, $P=20$"</span>,</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>    show_markers<span class="op">=</span><span class="va">False</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="long_range_simulations_files/figure-html/cell-38-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>ternary_plot_species_evolution(</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>    fp_stoch_df,</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="vs">r"$P_r=0.2, P_s=0.5, P_p=0.3, R=50, S=30, P=20$"</span>,</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="long_range_simulations_files/figure-html/cell-39-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>With fewer molecules, two species (scissors and paper) eventually become extinct, and the species that survives (rock) is the one that has the lowest invasion rate, similarly to the discrete-time model with a finite number of sites.</p>
<p>Visualizing reaction propensities:</p>
<div class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>smod.PlotPropensitiesTimeSeries(title<span class="op">=</span><span class="st">'Reaction Propensities, direct method</span><span class="ch">\n</span><span class="st">$P_r=0.2$, $P_s=0.5$, $P_p=0.3$, $R=50$, $S=30$, $P=20$'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="long_range_simulations_files/figure-html/cell-40-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>At <span class="math inline">\(t=0\)</span>, R1 propensity is <span class="math inline">\(R\cdot S\cdot P_r=50\cdot 30\cdot 0.2=300\)</span>, R2 propensity is <span class="math inline">\(S\cdot P\cdot P_s=30\cdot 20\cdot 0.5=300\)</span> and R3 propensity is <span class="math inline">\(P\cdot R\cdot P_p=20\cdot 50\cdot 0.3=300\)</span>, where <span class="math inline">\(R,S,P\)</span> denote the number of molecules of each species. The propensities of the reactions are equal, which is expected as the system is at the fixed point.</p>
<p>Plotting the time between two subsequent firings of a reaction:</p>
<div class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>smod.PlotWaitingtimesDistributions(title<span class="op">=</span><span class="st">'Time between subsequent firings of reactions, direct method</span><span class="ch">\n</span><span class="st">$P_r=0.2$, $P_s=0.5$, $P_p=0.3$, $R=50$, $S=30$, $P=20$'</span>)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>smod.PrintWaitingtimesMeans()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reaction    Mean
R1  0.004
R2  0.004
R3  0.004</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="long_range_simulations_files/figure-html/cell-41-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>The three reactions have the same average time between two subsequent firings. R2 waiting times are longer than R1 and R3 because the number of molecules of species <span class="math inline">\(S\)</span> and <span class="math inline">\(P\)</span> is lower than the number of molecules of species <span class="math inline">\(R\)</span>.</p>
<p>To approximate the deterministic behavior we can either perform multiple stochastic simulations and average the species copy numbers at each time point:</p>
<div class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>smod.DoStochSim(end<span class="op">=</span><span class="dv">100</span>, trajectories<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>smod.GetRegularGrid(n_samples<span class="op">=</span><span class="dv">50</span>)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>smod.PlotAverageSpeciesTimeSeries(</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>    colors<span class="op">=</span>[<span class="st">"tab:red"</span>, <span class="st">"purple"</span>, <span class="st">"gold"</span>],</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">"Average species in 100 stochastic simulations, direct method</span><span class="ch">\n</span><span class="st">$P_r=0.2$, $P_s=0.5$, $P_p=0.3$, $R=50$, $S=30$, $P=20$"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Info: 100 trajectories are generated
Info: Time simulation output of the trajectories is stored at RSP_model_reduced(trajectory).dat in directory: /Users/irenetesta/Stochpy/temp
Info: Simulation time: 0.2223360538482666                                                   </code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="long_range_simulations_files/figure-html/cell-42-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>To get an accurate prediction of the species distribution StochPy provides the function <code>DoCompleteStochSim()</code> that continues the simulation until the first four moments converge within a user-specified error:</p>
<div class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>smod.DoCompleteStochSim()</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>smod.PlotSpeciesDistributions(</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>    colors<span class="op">=</span>[<span class="st">"tab:red"</span>, <span class="st">"purple"</span>, <span class="st">"gold"</span>],</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">"Species distribution, direct method</span><span class="ch">\n</span><span class="st">$P_r=0.2$, $P_s=0.5$, $P_p=0.3$, $R=50$, $S=30$, $P=20$"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Info: 100000 time steps simulated
Info: 200000 time steps simulated
Info: 300000 time steps simulated
Info: 400000 time steps simulated
Info: 500000 time steps simulated
Info: 600000 time steps simulated
Info: 700000 time steps simulated
Info: 800000 time steps simulated
Info: 900000 time steps simulated
Info: 1000000 time steps simulated
Info: 1100000 time steps simulated
Info: 1200000 time steps simulated
Info: 1300000 time steps simulated
Info: 1400000 time steps simulated
Info: 1500000 time steps simulated
Info: 1600000 time steps simulated
Info: 1700000 time steps simulated
Info: 1800000 time steps simulated
Info: 1900000 time steps simulated
Info: 2000000 time steps simulated
Info: 2100000 time steps simulated
Info: 2200000 time steps simulated
Info: 2300000 time steps simulated
Info: 2400000 time steps simulated
Info: 2500000 time steps simulated
Info: 2600000 time steps simulated
Info: 2700000 time steps simulated
Info: 2800000 time steps simulated
Info: 2900000 time steps simulated
Info: 3000000 time steps simulated
Info: 3100000 time steps simulated
Info: 3200000 time steps simulated
Info: 3300000 time steps simulated
Info: 3400000 time steps simulated
Info: 3500000 time steps simulated
Info: 3600000 time steps simulated
Info: 3700000 time steps simulated
Info: 3800000 time steps simulated
Info: 3900000 time steps simulated
Info: 4000000 time steps simulated
Info: 4100000 time steps simulated
Info: 4200000 time steps simulated
Info: 4300000 time steps simulated
Info: 4400000 time steps simulated
Info: 4500000 time steps simulated
Info: 4600000 time steps simulated
Info: 4700000 time steps simulated
Info: 4800000 time steps simulated
Info: 4900000 time steps simulated
Info: 5000000 time steps simulated
Info: 5100000 time steps simulated
Info: 5200000 time steps simulated
Info: 5300000 time steps simulated
Info: 5400000 time steps simulated
Info: 5500000 time steps simulated
Info: 5600000 time steps simulated
Info: 5700000 time steps simulated
Info: 5800000 time steps simulated
Info: 5900000 time steps simulated
Info: 6000000 time steps simulated
Info: 6100000 time steps simulated
Info: 6200000 time steps simulated
Info: 6300000 time steps simulated
Info: 6400000 time steps simulated
Info: 6500000 time steps simulated
Info: 6600000 time steps simulated
Info: 6700000 time steps simulated
Info: 6800000 time steps simulated
Info: 6900000 time steps simulated
Info: 7000000 time steps simulated
Info: 7100000 time steps simulated
Info: 7200000 time steps simulated
Info: 7300000 time steps simulated
Info: 7400000 time steps simulated
Info: 7500000 time steps simulated
Info: 7600000 time steps simulated
Info: 7700000 time steps simulated
Info: 7800000 time steps simulated
Info: 7900000 time steps simulated
Info: 8000000 time steps simulated
Info: 8100000 time steps simulated
Info: 8200000 time steps simulated
Info: 8300000 time steps simulated
Info: 8400000 time steps simulated
Info: 8500000 time steps simulated
Info: 8600000 time steps simulated
Info: 8700000 time steps simulated
Info: 8800000 time steps simulated
Info: 8900000 time steps simulated
Info: 9000000 time steps simulated
Info: 9100000 time steps simulated
Info: 9200000 time steps simulated
Info: 9300000 time steps simulated
Info: 9400000 time steps simulated
Info: 9500000 time steps simulated
Info: 9600000 time steps simulated
Info: 9700000 time steps simulated
Info: 9800000 time steps simulated
Info: 9900000 time steps simulated
Info: 10000000 time steps simulated
Info: 10100000 time steps simulated
Info: 10200000 time steps simulated
Info: 10300000 time steps simulated
Info: 10400000 time steps simulated
Info: 10500000 time steps simulated
Info: 10600000 time steps simulated
Info: 10700000 time steps simulated
Info: 10800000 time steps simulated
Info: 10900000 time steps simulated
Info: 11000000 time steps simulated
Info: 11100000 time steps simulated
Info: 11200000 time steps simulated
Info: 11300000 time steps simulated
Info: 11400000 time steps simulated
Info: 11500000 time steps simulated
Info: 11600000 time steps simulated
Info: 11700000 time steps simulated
Info: 11800000 time steps simulated
Info: 11900000 time steps simulated
Info: 12000000 time steps simulated
Info: 12100000 time steps simulated
Info: 12200000 time steps simulated
Info: 12300000 time steps simulated
Info: 12400000 time steps simulated
Info: 12500000 time steps simulated
Info: 12600000 time steps simulated
Info: 12700000 time steps simulated
Info: 12800000 time steps simulated
Info: 12900000 time steps simulated
Info: 13000000 time steps simulated
Info: 13100000 time steps simulated
Info: 13200000 time steps simulated
Info: 13300000 time steps simulated
Info: 13400000 time steps simulated
Info: 13500000 time steps simulated
Info: 13600000 time steps simulated
Info: 13700000 time steps simulated
Info: 13800000 time steps simulated
Info: 13900000 time steps simulated
Info: 14000000 time steps simulated
Info: 14100000 time steps simulated
Info: 14200000 time steps simulated
Info: 14300000 time steps simulated
Info: 14400000 time steps simulated
Info: 14500000 time steps simulated
Info: 14600000 time steps simulated
Info: 14700000 time steps simulated
Info: 14800000 time steps simulated
Info: 14900000 time steps simulated
Info: 15000000 time steps simulated
Info: 15100000 time steps simulated
Info: 15200000 time steps simulated
Info: 15300000 time steps simulated
Info: 15400000 time steps simulated
Info: 15500000 time steps simulated
Info: 15600000 time steps simulated
Info: 15700000 time steps simulated
Info: 15800000 time steps simulated
Info: 15900000 time steps simulated
Info: 16000000 time steps simulated
Info: 16100000 time steps simulated
Info: 16200000 time steps simulated
Info: 16300000 time steps simulated
Info: 16400000 time steps simulated
Info: 16500000 time steps simulated
Info: 16600000 time steps simulated
Info: 16700000 time steps simulated
Info: 16800000 time steps simulated
Info: 16900000 time steps simulated
Info: 17000000 time steps simulated
Info: 17100000 time steps simulated
Info: 17200000 time steps simulated
Info: 17300000 time steps simulated
Info: 17400000 time steps simulated
Info: 17500000 time steps simulated
Info: 17600000 time steps simulated
Info: 17700000 time steps simulated
Info: 17800000 time steps simulated
Info: 17900000 time steps simulated
Info: 18000000 time steps simulated
Info: 18100000 time steps simulated
Info: 18200000 time steps simulated
Info: 18300000 time steps simulated
Info: 18400000 time steps simulated
Info: 18500000 time steps simulated
Info: 18600000 time steps simulated
Info: 18700000 time steps simulated
Info: 18800000 time steps simulated
Info: 18900000 time steps simulated
Info: 19000000 time steps simulated
Info: 19100000 time steps simulated
Info: 19200000 time steps simulated
Info: 19300000 time steps simulated
Info: 19400000 time steps simulated
Info: 19500000 time steps simulated
Info: 19600000 time steps simulated
Info: 19700000 time steps simulated
Info: 19800000 time steps simulated
Info: 19900000 time steps simulated
Info: 20000000 time steps simulated
Info: 20100000 time steps simulated
Info: 20200000 time steps simulated
Info: 20300000 time steps simulated
Info: 20400000 time steps simulated
Info: 20500000 time steps simulated
Info: 20600000 time steps simulated
Info: 20700000 time steps simulated
Info: 20800000 time steps simulated
Info: 20900000 time steps simulated
Info: 21000000 time steps simulated
Info: 21100000 time steps simulated
Info: 21200000 time steps simulated
Info: 21300000 time steps simulated
Info: 21400000 time steps simulated
Info: 21500000 time steps simulated
Info: 21600000 time steps simulated
Info: 21700000 time steps simulated
Info: 21800000 time steps simulated
Info: Simulation time 13.48359</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="long_range_simulations_files/figure-html/cell-43-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>Species <span class="math inline">\(p\)</span> probability mass is concentrated at lower values, while species <span class="math inline">\(r\)</span> and <span class="math inline">\(s\)</span> have a more uniform distribution.</p>
<p>Computing mean and standard deviation of the species copy number is not straightforward as the time between two events is not constant, thus it is necessary to track the time spent in each state for each species. This computation is implemented by the following functions:</p>
<div class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>smod.PrintSpeciesMeans()</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>smod.PrintSpeciesStandardDeviations()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Species Mean
R   53.108
S   28.366
P   18.526
Species Standard Deviation
R   23.734
S   19.751
P   18.520</code></pre>
</div>
</div>
<p>We can also experiment with delayed reactions, consisting of an exponential waiting time as initiation step with a subsequent delay time. We set a fixed delay of five seconds on reaction R1 (<span class="math inline">\(R + S \rightarrow 2R\)</span>). This means that after R1 fires, it takes exactly five seconds before products are produced. By setting <code>nonconsuming_reactions=["R1"]</code>, reactants are consumed at completion.</p>
<div class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>smod.SetDelayParameters({<span class="st">"R1"</span>:(<span class="st">"fixed"</span>,<span class="dv">5</span>)}, nonconsuming_reactions<span class="op">=</span>[<span class="st">"R1"</span>])</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>smod.DoDelayedStochSim(mode<span class="op">=</span><span class="st">"time"</span>,end<span class="op">=</span><span class="dv">10</span>,trajectories<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>smod.PlotAverageSpeciesTimeSeries()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>*** WARNING ***: an invalid method (Direct) was selected. Switching to the Delayed Direct Method.
Info: Delayed Direct Method is selected to perform delayed stochastic simulations.
Parsing file: ../long_range_models/RSP_model_reduced.psc
Info: No reagents have been fixed
Info: 100 trajectories are generated
Info: Time simulation output of the trajectories is stored at RSP_model_reduced(trajectory).dat in directory: /Users/irenetesta/Stochpy/temp
Info: Simulation time: 17.760042905807495                                                   *** WARNING ***: No regular grid is created yet. Use GetRegularGrid(n_samples) if averaged results are unsatisfactory (e.g. more or less 'samples')</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="long_range_simulations_files/figure-html/cell-45-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>If R1 is delayed, after the first five seconds, the system will reach the absorbing state where only species <span class="math inline">\(r\)</span> is present.</p>
<p>Performing a stochastic simulation with equal initial population densities:</p>
<div class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>smod.SetDelayParameters({})</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>smod.ChangeInitialSpeciesCopyNumber(<span class="st">"R"</span>, <span class="dv">33</span>)</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>smod.ChangeInitialSpeciesCopyNumber(<span class="st">"S"</span>, <span class="dv">33</span>)</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>smod.ChangeInitialSpeciesCopyNumber(<span class="st">"P"</span>, <span class="dv">33</span>)</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>smod.DoStochSim(end<span class="op">=</span><span class="dv">1000</span>, method<span class="op">=</span><span class="st">"direct"</span>)</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>eq_stoch_df <span class="op">=</span> pd.DataFrame(smod.data_stochsim.species, columns<span class="op">=</span>[<span class="st">'R'</span>, <span class="st">'S'</span>, <span class="st">'P'</span>])</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>line_plot_species_evolution(</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>    eq_stoch_df,</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">"$P_r=0.2$, $P_s=0.5$, $P_p=0.3$, $R=33$, $S=33$, $P=33$"</span>,</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>    show_markers<span class="op">=</span><span class="va">False</span></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Info: Direct method is selected to perform stochastic simulations.
Parsing file: ../long_range_models/RSP_model_reduced.psc
Info: No reagents have been fixed
Info: 1 trajectory is generated
simulation done!               
Info: Number of time steps 469 End time 1.0884810590458118
Info: Simulation time 0.00361</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="long_range_simulations_files/figure-html/cell-46-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>Differently from the simulation with ODEs, the system does not exhibit sustained oscillations, as the inherent randomness in the timing and sequence of reactions introduces fluctuations that prevent the emergence of periodic behavior.</p>
</section>
<section id="stochastic-model-checking" class="level2">
<h2 class="anchored" data-anchor-id="stochastic-model-checking">4. Stochastic model checking</h2>
<p>Stochastic model checking enables the verification of properties in stochastic systems by quantifying their probabilities through systematic exploration of all possible system behaviors. To perform stochastic model checking we need to translate the model into a Continuous Time Markov Chain (CTMC) and specify the properties we want to verify. Dynamical properties of the resulting CTMC could then be analyzed using the stochastic model checker <a href="https://www.prismmodelchecker.org">PRISM</a>. PRISM describes CTMC states through a set of bounded integer variables, hence we need to discretize the state space of the system replacing the continuous variables with bounded integer variables. This leads to the following CTMC specification in PRISM input language, where model parameters are defined by <code>Pr</code>, <code>Ps</code> and <code>Pp</code> constants (initialized with the same values used in the previous simulations), <code>MAX</code> is the maximum number of molecules per species (set to 100 due to the prohibitive computational time required for higher values) and we have three transitions describing the three possible reactions:</p>
<div class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>cat ..<span class="op">/</span>long_range_models<span class="op">/</span>RSP.prism</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ctmc

const double Pr = 0.2;
const double Ps = 0.5;
const double Pp = 0.3;

const int MAX = 100;

module RSP

  r : [0..MAX] init 50;
  s : [0..MAX] init 30;
  p : [0..MAX] init 20;

  [] r&gt;0 &amp; r&lt;MAX &amp; s&gt;0 -&gt; Pr*r*s : (r'=r+1) &amp; (s'=s-1);
  [] s&gt;0 &amp; s&lt;MAX &amp; p&gt;0 -&gt; Ps*s*p : (s'=s+1) &amp; (p'=p-1);
  [] p&gt;0 &amp; p&lt;MAX &amp; r&gt;0 -&gt; Pp*p*r : (p'=p+1) &amp; (r'=r-1);

endmodule</code></pre>
</div>
</div>
<p>By observing that <code>r+s+p=1</code>, we can simplify the model to reduce the computational times needed to verify properties by removing the variable <code>p</code>, obtaining the following PRISM input:</p>
<div class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>cat ..<span class="op">/</span>long_range_models<span class="op">/</span>RSP_reduced.prism</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ctmc

const double Pr = 0.2;
const double Ps = 0.5;
const double Pp = 0.3;

const int MAX = 100;

module RSP

  r : [0..MAX] init 50;
  s : [0..MAX] init 30;

  [] r&gt;0 &amp; r&lt;MAX &amp; s&gt;0 -&gt; Pr*r*s : (r'=r+1) &amp; (s'=s-1);
  [] s&gt;0 &amp; s&lt;MAX &amp; (MAX-r-s)&gt;0 -&gt; Ps*s*(MAX-r-s) : (s'=s+1);
  [] (MAX-r-s)&gt;0 &amp; (MAX-r-s)&lt;MAX &amp; r&gt;0 -&gt; Pp*(MAX-r-s)*r : (r'=r-1);

endmodule</code></pre>
</div>
</div>
<p>Let’s visualize the graphical representation of the CTMC (that can be exported from PRISM) for a system with MAX=10:</p>
<div class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'../results/ctmc.dot'</span>, <span class="st">'r'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>    dot_data <span class="op">=</span> <span class="bu">file</span>.read()</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>graph <span class="op">=</span> Source(dot_data)</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>graph</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="48">
<p><img src="long_range_simulations_files/figure-html/cell-49-output-1.svg" class="img-fluid"></p>
</div>
</div>
<p>The initial state of the system is state 48, where all exit rates are equal to 3, corresponding to the equilibrium point.</p>
<p>We can define a list of properties to be verified, using the CSL temporal logic:</p>
<div class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>cat ..<span class="op">/</span>long_range_models<span class="op">/</span>RSP_properties.csl</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>P=?[ F r=0 ]

P=?[ F s=0 ]

P=?[ F (MAX-r-s)=0 ]

P=?[ F (r=70 &amp; (F r=0)) ]

P=?[ F (s=70 &amp; (F s=0)) ]

P=?[ F ((MAX-r-s)=70 &amp; (F (MAX-r-s)=0)) ]

P=?[ F (MAX-r-s)=0 &amp; s=0 ]

P=?[ F s=0 &amp; r=0 ]

P=?[ F r=0 &amp; (MAX-r-s)=0 ]

const int time;

P=? [ F&lt;time r=0 ]

P=? [ F&lt;time s=0 ]

P=? [ F&lt;time (MAX-r-s)=0 ]

P=? [F&lt;time (r=0 | r=MAX | s=0) &amp; (s=0 | s=MAX | (MAX-r-s)=0) &amp; ((MAX-r-s)=0 | (MAX-r-s)=MAX | r=0)]

const int x;

P=? [ F=1 r&gt;=x &amp; r&lt;x+10 ]

P=? [ F=1 s&gt;=x &amp; s&lt;x+10 ]

P=? [ F=1 (MAX-r-s)&gt;=x &amp; (MAX-r-s)&lt;x+10 ]</code></pre>
</div>
</div>
<p>Loading the first lines of PRISM log file:</p>
<div class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>sed <span class="op">-</span>n <span class="st">'9,128p'</span> ..<span class="op">/</span>results<span class="op">/</span>prism_log.txt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Type:        CTMC
Modules:     RSP
Variables:   r s

---------------------------------------------------------------------

Model checking: P=? [ F r=0 ]

Building model...

Computing reachable states...

Reachability (BFS): 121 iterations in 0.00 seconds (average 0.000000, setup 0.00)

Time for model construction: 0.124 seconds.

Warning: Deadlocks detected and fixed in 3 states

Type:        CTMC
States:      5151 (1 initial)
Transitions: 14853

Rate matrix: 44090 nodes (3611 terminal), 14853 minterms, vars: 14r/14c

Diagonals vector: 7997 nodes (2482 terminal), 5151 minterms
Embedded Markov chain: 72269 nodes (13625 terminal), 14853 minterms

Prob0: 100 iterations in 0.03 seconds (average 0.000310, setup 0.00)

Prob1: 99 iterations in 0.06 seconds (average 0.000626, setup 0.00)

yes = 200, no = 100, maybe = 4851

Computing remaining probabilities...
Engine: Hybrid

Building hybrid MTBDD matrix... [levels=14, nodes=72180] [3.3 MB]
Adding explicit sparse matrices... [levels=14, num=1, compact] [168.3 KB]
Creating vector for diagonals... [dist=1, compact] [10.1 KB]
Creating vector for RHS... [dist=2, compact] [10.1 KB]
Allocating iteration vectors... [2 x 40.2 KB]
TOTAL: [3.6 MB]

Starting iterations...

Jacobi: 5067 iterations in 4.03 seconds (average 0.000043, setup 3.81)

Value in the initial state: 0.1412982989479114

Time for model checking: 5.41 seconds.

Result: 0.1412982989479114 (+/- 1.4120125376176834E-6 estimated; rel err 9.993131892820674E-6)

---------------------------------------------------------------------

Model checking: P=? [ F s=0 ]

Diagonals vector: 7997 nodes (2482 terminal), 5151 minterms
Embedded Markov chain: 72269 nodes (13625 terminal), 14853 minterms

Prob0: 100 iterations in 0.06 seconds (average 0.000620, setup 0.00)

Prob1: 99 iterations in 0.02 seconds (average 0.000162, setup 0.00)

yes = 200, no = 100, maybe = 4851

Computing remaining probabilities...
Engine: Hybrid

Building hybrid MTBDD matrix... [levels=14, nodes=72180] [3.3 MB]
Adding explicit sparse matrices... [levels=14, num=1, compact] [168.3 KB]
Creating vector for diagonals... [dist=1, compact] [10.1 KB]
Creating vector for RHS... [dist=2, compact] [10.1 KB]
Allocating iteration vectors... [2 x 40.2 KB]
TOTAL: [3.6 MB]

Starting iterations...

Jacobi: 5098 iterations in 2.55 seconds (average 0.000022, setup 2.44)

Value in the initial state: 0.9829185886675442

Time for model checking: 5.287 seconds.

Result: 0.9829185886675442 (+/- 9.824397199114573E-6 estimated; rel err 9.995128093398498E-6)

---------------------------------------------------------------------

Model checking: P=? [ F (MAX-r-s)=0 ]

Diagonals vector: 7997 nodes (2482 terminal), 5151 minterms
Embedded Markov chain: 72269 nodes (13625 terminal), 14853 minterms

Prob0: 100 iterations in 0.08 seconds (average 0.000780, setup 0.00)

Prob1: 99 iterations in 0.00 seconds (average 0.000000, setup 0.00)

yes = 200, no = 100, maybe = 4851

Computing remaining probabilities...
Engine: Hybrid

Building hybrid MTBDD matrix... [levels=14, nodes=72180] [3.3 MB]
Adding explicit sparse matrices... [levels=14, num=1, compact] [168.3 KB]
Creating vector for diagonals... [dist=1, compact] [10.1 KB]
Creating vector for RHS... [dist=2, compact] [10.1 KB]
Allocating iteration vectors... [2 x 40.2 KB]
TOTAL: [3.6 MB]

Starting iterations...

Jacobi: 5108 iterations in 2.09 seconds (average 0.000028, setup 1.95)

Value in the initial state: 0.8745308920684021

Time for model checking: 5.281 seconds.

Result: 0.8745308920684021 (+/- 8.735542417834342E-6 estimated; rel err 9.988832295190192E-6)

---------------------------------------------------------------------</code></pre>
</div>
</div>
<p>By inspecting the log file, we can see that the model has 5151 states and 14853 transitions.</p>
<p>The probabilities of extinction for species r, s, and p are 0.14, 0.98, and 0.87, respectively.</p>
<p>Loading subsequent lines of PRISM log file:</p>
<div class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>sed <span class="op">-</span>n <span class="st">'128,278p'</span> ..<span class="op">/</span>results<span class="op">/</span>PRISM_log.txt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>---------------------------------------------------------------------

Model checking: P=? [ F (r=70&amp;(F r=0)) ]

Building deterministic automaton (for F ("L0"&amp;(F "L1")))...
DFA has 3 states, 1 goal states.
Time for deterministic automaton translation: 0.03 seconds.

Constructing MC-DFA product...

Reachability (BFS): 181 iterations in 0.05 seconds (average 0.000260, setup 0.00)

States:      9806 (1 initial)
Transitions: 28340

Transition matrix: 44164 nodes (3611 terminal), 28340 minterms, vars: 16r/16c

Skipping BSCC computation since acceptance is defined via goal states...

Computing reachability probabilities...

Diagonals vector: 8037 nodes (2485 terminal), 9806 minterms
Embedded Markov chain: 72343 nodes (13625 terminal), 28340 minterms

Prob0: 208 iterations in 0.06 seconds (average 0.000303, setup 0.00)

Prob1: 99 iterations in 0.11 seconds (average 0.001101, setup 0.00)

yes = 200, no = 339, maybe = 9267

Computing remaining probabilities...
Engine: Hybrid

Building hybrid MTBDD matrix... [levels=16, nodes=72279] [3.3 MB]
Adding explicit sparse matrices... [levels=16, num=1, compact] [224.6 KB]
Creating vector for diagonals... [dist=1, compact] [19.2 KB]
Creating vector for RHS... [dist=2, compact] [19.2 KB]
Allocating iteration vectors... [2 x 76.6 KB]
TOTAL: [3.7 MB]

Starting iterations...

Jacobi: 5067 iterations in 4.00 seconds (average 0.000117, setup 3.41)

Value in the initial state: 0.1412860009175909

Time for model checking: 5.828 seconds.

Result: 0.1412860009175909

---------------------------------------------------------------------

Model checking: P=? [ F (s=70&amp;(F s=0)) ]

Building deterministic automaton (for F ("L0"&amp;(F "L1")))...
DFA has 3 states, 1 goal states.
Time for deterministic automaton translation: 0.0 seconds.

Constructing MC-DFA product...

Reachability (BFS): 231 iterations in 0.08 seconds (average 0.000338, setup 0.00)

States:      9806 (1 initial)
Transitions: 28340

Transition matrix: 51284 nodes (3611 terminal), 28340 minterms, vars: 16r/16c

Skipping BSCC computation since acceptance is defined via goal states...

Computing reachability probabilities...

Diagonals vector: 9513 nodes (2483 terminal), 9806 minterms
Embedded Markov chain: 78314 nodes (13625 terminal), 28340 minterms

Prob0: 208 iterations in 0.05 seconds (average 0.000226, setup 0.00)

Prob1: 99 iterations in 0.02 seconds (average 0.000162, setup 0.00)

yes = 200, no = 339, maybe = 9267

Computing remaining probabilities...
Engine: Hybrid

Building hybrid MTBDD matrix... [levels=16, nodes=83010] [3.8 MB]
Adding explicit sparse matrices... [levels=16, num=1, compact] [224.6 KB]
Creating vector for diagonals... [dist=1, compact] [19.2 KB]
Creating vector for RHS... [dist=2, compact] [19.2 KB]
Allocating iteration vectors... [2 x 76.6 KB]
TOTAL: [4.2 MB]

Starting iterations...

Jacobi: 5289 iterations in 3.28 seconds (average 0.000098, setup 2.77)

Value in the initial state: 0.6506808914402584

Time for model checking: 6.768 seconds.

Result: 0.6506808914402584

---------------------------------------------------------------------

Model checking: P=? [ F ((MAX-r-s)=70&amp;(F (MAX-r-s)=0)) ]

Building deterministic automaton (for F ("L0"&amp;(F "L1")))...
DFA has 3 states, 1 goal states.
Time for deterministic automaton translation: 0.008 seconds.

Constructing MC-DFA product...

Reachability (BFS): 221 iterations in 0.03 seconds (average 0.000140, setup 0.00)

States:      9806 (1 initial)
Transitions: 28340

Transition matrix: 50473 nodes (3611 terminal), 28340 minterms, vars: 16r/16c

Skipping BSCC computation since acceptance is defined via goal states...

Computing reachability probabilities...

Diagonals vector: 9522 nodes (2485 terminal), 9806 minterms
Embedded Markov chain: 78216 nodes (13625 terminal), 28340 minterms

Prob0: 208 iterations in 0.05 seconds (average 0.000226, setup 0.00)

Prob1: 99 iterations in 0.05 seconds (average 0.000475, setup 0.00)

yes = 200, no = 339, maybe = 9267

Computing remaining probabilities...
Engine: Hybrid

Building hybrid MTBDD matrix... [levels=16, nodes=81568] [3.7 MB]
Adding explicit sparse matrices... [levels=16, num=1, compact] [224.6 KB]
Creating vector for diagonals... [dist=1, compact] [19.2 KB]
Creating vector for RHS... [dist=2, compact] [19.2 KB]
Allocating iteration vectors... [2 x 76.6 KB]
TOTAL: [4.1 MB]

Starting iterations...

Jacobi: 5386 iterations in 2.36 seconds (average 0.000038, setup 2.16)

Value in the initial state: 0.28962347433238994

Time for model checking: 6.576 seconds.

Result: 0.28962347433238994

---------------------------------------------------------------------</code></pre>
</div>
</div>
<p>The probability of a species to go extinct after having reached a density of 0.7 is 0.14 for species r, 0.65 for species s, and 0.29 for species p.</p>
<p>Loading subsequent lines of PRISM log file:</p>
<div class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>sed <span class="op">-</span>n <span class="st">'278,375p'</span> ..<span class="op">/</span>results<span class="op">/</span>PRISM_log.txt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>---------------------------------------------------------------------

Model checking: P=? [ F s=0&amp;r=0 ]

Diagonals vector: 7997 nodes (2482 terminal), 5151 minterms
Embedded Markov chain: 72269 nodes (13625 terminal), 14853 minterms

Prob0: 198 iterations in 0.05 seconds (average 0.000237, setup 0.00)

Prob1: 50 iterations in 0.01 seconds (average 0.000300, setup 0.00)

yes = 100, no = 200, maybe = 4851

Computing remaining probabilities...
Engine: Hybrid

Building hybrid MTBDD matrix... [levels=14, nodes=72180] [3.3 MB]
Adding explicit sparse matrices... [levels=14, num=1, compact] [168.3 KB]
Creating vector for diagonals... [dist=1, compact] [10.1 KB]
Creating vector for RHS... [dist=2, compact] [10.1 KB]
Allocating iteration vectors... [2 x 40.2 KB]
TOTAL: [3.6 MB]

Starting iterations...

Jacobi: 5060 iterations in 2.31 seconds (average 0.000015, setup 2.23)

Value in the initial state: 0.12484498983774625

Time for model checking: 5.309 seconds.

Result: 0.12484498983774625 (+/- 1.2472498654345966E-6 estimated; rel err 9.990387816568165E-6)

---------------------------------------------------------------------

Model checking: P=? [ F r=0&amp;(MAX-r-s)=0 ]

Diagonals vector: 7997 nodes (2482 terminal), 5151 minterms
Embedded Markov chain: 72269 nodes (13625 terminal), 14853 minterms

Prob0: 198 iterations in 0.00 seconds (average 0.000000, setup 0.00)

Prob1: 50 iterations in 0.01 seconds (average 0.000300, setup 0.00)

yes = 100, no = 200, maybe = 4851

Computing remaining probabilities...
Engine: Hybrid

Building hybrid MTBDD matrix... [levels=14, nodes=72180] [3.3 MB]
Adding explicit sparse matrices... [levels=14, num=1, compact] [168.3 KB]
Creating vector for diagonals... [dist=1, compact] [10.1 KB]
Creating vector for RHS... [dist=2, compact] [10.1 KB]
Allocating iteration vectors... [2 x 40.2 KB]
TOTAL: [3.6 MB]

Starting iterations...

Jacobi: 5141 iterations in 2.62 seconds (average 0.000030, setup 2.47)

Value in the initial state: 0.01645373692597371

Time for model checking: 5.285 seconds.

Result: 0.01645373692597371 (+/- 1.6439874796782045E-7 estimated; rel err 9.991575087620501E-6)

---------------------------------------------------------------------

Model checking: P=? [ F (MAX-r-s)=0&amp;s=0 ]

Diagonals vector: 7997 nodes (2482 terminal), 5151 minterms
Embedded Markov chain: 72269 nodes (13625 terminal), 14853 minterms

Prob0: 198 iterations in 0.05 seconds (average 0.000237, setup 0.00)

Prob1: 50 iterations in 0.00 seconds (average 0.000000, setup 0.00)

yes = 100, no = 200, maybe = 4851

Computing remaining probabilities...
Engine: Hybrid

Building hybrid MTBDD matrix... [levels=14, nodes=72180] [3.3 MB]
Adding explicit sparse matrices... [levels=14, num=1, compact] [168.3 KB]
Creating vector for diagonals... [dist=1, compact] [10.1 KB]
Creating vector for RHS... [dist=2, compact] [10.1 KB]
Allocating iteration vectors... [2 x 40.2 KB]
TOTAL: [3.6 MB]

Starting iterations...

Jacobi: 5107 iterations in 1.92 seconds (average 0.000006, setup 1.89)

Value in the initial state: 0.8580768529067467

Time for model checking: 5.346 seconds.

Result: 0.8580768529067467 (+/- 8.574549754478324E-6 estimated; rel err 9.992752660128196E-6)</code></pre>
</div>
</div>
<p>The probability that each species will outcompete the other two (corresponding to the system’s steady states) is 0.12 for species p, 0.02 for species s, and 0.86 for species r.</p>
<p>By varying the constant <code>time</code> between 1 and 10, we can plot the extinction probabilities for each species, i.e.:</p>
<pre><code>const int time;
P=? [ F&lt;time r=0 ]
P=? [ F&lt;time s=0 ]
P=? [ F&lt;time (MAX-r-s)=0 ]</code></pre>
<p><img align="center" src="../results/extintion_fixed.png" width="600px"></p>
<p>Rock, the species with the lowest invasion rate, is the most likely to survive. This result is due to the finiteness of the populations, which prevents the system to remain at the fixed point.</p>
<p>We can also plot the probability of reaching any absorbing state (a state where no further transitions are possible) within the first 6 time units, i.e.:</p>
<pre><code>const int time;
P=? [F&lt;time (r=0 | r=MAX | s=0) &amp; (s=0 | s=MAX | (MAX-r-s)=0) &amp; ((MAX-r-s)=0 | (MAX-r-s)=MAX | r=0)]</code></pre>
<p><img align="center" src="../results/absorbing_state.png" width="600px"></p>
<p>After 5 time steps, the system reaches an absorbing state with certainty.</p>
<p>By binning the number of individuals in disjoint intervals (x &lt;= number of individuals &lt; x+10), we can plot the probabilities for each species being in a certain interval at time t=1, i.e.:</p>
<pre><code>const int x;
P=? [ F=1 r&gt;=x &amp; r&lt;x+10 ]
P=? [ F=1 s&gt;=x &amp; s&lt;x+10 ]
P=? [ F=1 (MAX-r-s)&gt;=x &amp; (MAX-r-s)&lt;x+10 ]</code></pre>
<p><img align="center" src="../results/individuals_fixed.png" width="600px"></p>
<p>After a time step, the probability mass of species <span class="math inline">\(s\)</span> and <span class="math inline">\(p\)</span> is concentrated at lower values, while species <span class="math inline">\(r\)</span> has a more uniform distribution.</p>
<p>PRISM can also be used to conduct stochastic simulations. For example, here is a simulation of the system where, similar to the simulation performed with <code>StochPy</code>, species <span class="math inline">\(r\)</span> is the only one to survive.</p>
<p><img align="center" src="../results/prism_simulation.png" width="600px"></p>
</section>
<section id="petri-net-analysis" class="level2">
<h2 class="anchored" data-anchor-id="petri-net-analysis">5. Petri net analysis</h2>
<p>A graphical representation of a system of chemical reaction can also be given in terms of Petri nets. Several variants of Petri nets exist, here we consider stochastic Petri nets, a variant that allows the modeling of stochastic systems.</p>
<p>For the rock-scissors-paper model, analyzing the net through property verification is relatively straightforward and doesn’t provide substantial insights. However, we will carry out this verification as a tutorial to illustrate the step-by-step approach to modeling and analyzing more complex biochemical networks.</p>
<p>The Petri net representing the system was created using the <a href="https://www-dssz.informatik.tu-cottbus.de/DSSZ/Software/Snoopy">Snoopy tool</a>, saved as <code>./long_range_models/rsp.spn</code>, and subsequently imported into the <a href="https://www-dssz.informatik.tu-cottbus.de/DSSZ/Software/Charlie">Charlie tool</a> for analysis.</p>
<p>Let’s introduce some definitions, necessary for the analysis of the Petri net.</p>
<p>A Stochastic Petri net consists of places, transitions with corresponding kinetic functions, arcs and tokens. Places represent the species, transitions represent the reactions, arcs represent the flow of species between reactions and tokens represent the number of molecules of each species.</p>
<p>More formally, a stochastic Petri net is a quintuple <span class="math inline">\(N = (P, T, f, \nu, m_0)\)</span>, where</p>
<ul>
<li><span class="math inline">\(P\)</span> and <span class="math inline">\(T\)</span> are finite, non empty, and disjoint sets. <span class="math inline">\(P\)</span> is the set of places (in the figures represented by circles). <span class="math inline">\(T\)</span> is the set of transitions (in the figures represented by rectangles);</li>
<li><span class="math inline">\(f : ((P \times T)\cup (T \times P)) \rightarrow \mathbb{N}_0\)</span> defines the set of directed arcs, weighted by nonnegative integer values;</li>
<li><span class="math inline">\(\nu:T \rightarrow \Psi\)</span>, with <span class="math inline">\(\Psi=M\rightarrow R\geq 0\)</span>, is a function that assigns to each transition a function corresponding to the computation of a kinetic formula to every possible marking <span class="math inline">\(m \in M\)</span>;</li>
<li><span class="math inline">\(m_0 \in M: P \rightarrow \mathbb{N}_0\)</span> gives the initial marking.</li>
</ul>
<p>The stochastic Petri net for the rock-paper-scissor system is shown below, where we set the initial marking <span class="math inline">\(P=20, R=50, S=30\)</span> and made the kinetic functions correspond to the law of mass action with constants equal to the invasion rates <span class="math inline">\(P_r=0.2\)</span>, <span class="math inline">\(P_s=0.5\)</span> and <span class="math inline">\(P_p=0.3\)</span>:</p>
<p><img align="center" src="../results/petri_net.png" width="200px"></p>
<p>The <strong>preset of a node</strong> <span class="math inline">\(x\in P \cup T\)</span> is defined as <span class="math inline">\(•x:=\{y\in P\cup T |f(y,x) \neq 0\}\)</span>, and its post set as <span class="math inline">\(x• :=\{y\in P \cup T| f(x,y) \neq 0\}\)</span>. Altogether we get four types of sets: - <span class="math inline">\(•t\)</span>, the <strong>preplaces</strong> of a transition <span class="math inline">\(t\)</span>, consisting of the reaction’s precursors - <span class="math inline">\(t•\)</span>, the <strong>postplaces</strong> of a transition <span class="math inline">\(t\)</span>, consisting of the reaction’s products - <span class="math inline">\(•p\)</span>, the <strong>pretransitions</strong> of a place <span class="math inline">\(p\)</span>, consisting of all reactions producing this species - <span class="math inline">\(p•\)</span>, the <strong>posttransitions</strong> of a place <span class="math inline">\(p\)</span>, consisting of all reactions consuming this species</p>
<p>Given a set of places <span class="math inline">\(S=p_1, p_2, \ldots\)</span>, the pre-transition of a set of places <span class="math inline">\(S\)</span> is defined as <span class="math inline">\(•S=•p_1 \cup •p_2 \cup \ldots\)</span>, while the post-transition of a set of places <span class="math inline">\(S\)</span> is defined as <span class="math inline">\(S•=p_1• \cup p_2• \cup \ldots\)</span>.</p>
<p>In this particular net, the pretransition and posttransition of the sites are as follows: - <span class="math inline">\(•P=\{Pp\}\)</span> - <span class="math inline">\(•R=\{Pr\}\)</span> - <span class="math inline">\(•S=\{Ps\}\)</span> - <span class="math inline">\(P•=\{Pp,Ps\}\)</span> - <span class="math inline">\(R•=\{Pr,Pp\}\)</span> - <span class="math inline">\(S•=\{Ps,Pr\}\)</span></p>
<p>The <strong>incidence matrix</strong> of <span class="math inline">\(\mathcal{N}\)</span> is a matrix <span class="math inline">\(C:P\times T \rightarrow \mathbb{Z}\)</span>, indexed by <span class="math inline">\(P\)</span> and <span class="math inline">\(T\)</span>, such that <span class="math inline">\(C(p,t)=f(t,p)−f(p,t)\)</span>.</p>
<p>Loading the file containing the incidence matrix produced by Charlie:</p>
<div class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>cat ..<span class="op">/</span>results<span class="op">/</span>petri_net_incidence_matrix.txtm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>placeNames = {P R S };
transitionNames = {Pp Pr Ps };
C=[
1 0 -1 ;
-1 1 0 ;
0 -1 1 ;
];</code></pre>
</div>
</div>
<p>We can easily verify that it is obtained by <span class="math display">\[C = \begin{bmatrix}
2 &amp; 0 &amp; 0 \\
0 &amp; 2 &amp; 0 \\
0 &amp; 0 &amp; 2
\end{bmatrix}
-
\begin{bmatrix}
1 &amp; 0 &amp; 1 \\
1 &amp; 1 &amp; 0 \\
0 &amp; 1 &amp; 1
\end{bmatrix}\]</span></p>
<p>and we can compute its rank (which is necessary to determine if certain properties of the net hold, as discussed later) as follows:</p>
<div class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>C <span class="op">=</span> Matrix([[<span class="dv">1</span>, <span class="dv">0</span>, <span class="op">-</span><span class="dv">1</span>], [<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>], [<span class="dv">0</span>, <span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>]])</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>rank <span class="op">=</span> C.rank()</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>rank</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="54">
<pre><code>2</code></pre>
</div>
</div>
<p>A <strong>place vector</strong> (<strong>transition vector</strong>) is a vector <span class="math inline">\(x : P \rightarrow \mathbb{Z}\)</span>, indexed by <span class="math inline">\(P\)</span> (<span class="math inline">\(y : T \rightarrow \mathbb{Z}\)</span>, indexed by <span class="math inline">\(T\)</span>).</p>
<p>A place vector (transition vector) is called a <strong>P-invariant</strong> (<strong>T-invariant</strong>) if it is a nontrivial nonnegative integer solution of the linear equation system <span class="math inline">\(x \cdot C = 0\)</span> (<span class="math inline">\(C \cdot y = 0\)</span>).</p>
<p>If <span class="math inline">\(p\)</span> is a P-invariant, then the weighted sum of tokens across the places (using the weights specified by the p-invariant) is preserved under the firing of transitions. If <span class="math inline">\(t\)</span> is a T-invariant, then if you fire the transitions according to the vector <span class="math inline">\(t\)</span> (where the number of times each transition is fired is given by the corresponding entry in <span class="math inline">\(t\)</span>), the net’s marking will remain unchanged.</p>
<p>Computing P-invariants:</p>
<div class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>x1, x2, x3 <span class="op">=</span> symbols(<span class="st">'x1 x2 x3'</span>)</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> Matrix([x1, x2, x3])</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>equation <span class="op">=</span> Eq(x.T <span class="op">*</span> C, Matrix([[<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>]]))</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>solution <span class="op">=</span> solve(equation, (x1, x2, x3), <span class="bu">dict</span><span class="op">=</span><span class="va">True</span>)</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>solution</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="55">
<pre><code>[{x1: x3, x2: x3}]</code></pre>
</div>
</div>
<p>Any vector of the form <span class="math inline">\([x,x,x]\)</span> is a place invariant. In fact it is trivial that the sum of the number of tokens in the places is constant (equal to 100).</p>
<p>Checking the file containing the P-invariants computed by Charlie:</p>
<div class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>cat ..<span class="op">/</span>results<span class="op">/</span>rsp_P.inv</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>minimal semipositive place invariants=
1   |   0.P     :1,
    |   1.R     :1,
    |   2.S     :1</code></pre>
</div>
</div>
<p>Computing T-invariants:</p>
<div class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>y1, y2, y3 <span class="op">=</span> symbols(<span class="st">'y1 y2 y3'</span>)</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> Matrix([y1, y2, y3])</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>equation <span class="op">=</span> Eq(C <span class="op">*</span> y, Matrix([[<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>]]).T)</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>solution <span class="op">=</span> solve(equation, (y1, y2, y3), <span class="bu">dict</span><span class="op">=</span><span class="va">True</span>)</span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>solution</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="57">
<pre><code>[{y1: y3, y2: y3}]</code></pre>
</div>
</div>
<p>Any vector of the form <span class="math inline">\([y,y,y]\)</span> is a transition invariant. In fact it is trivial that applying the three transitions an equal number of times will not change the marking of the net.</p>
<p>Checking the file containing the T-invariants computed by Charlie:</p>
<div class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>cat ..<span class="op">/</span>results<span class="op">/</span>rsp_T.inv</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>minimal semipositive transition invariants=
1   |   0.Pp        :1,
    |   1.Pr        :1,
    |   2.Ps        :1</code></pre>
</div>
</div>
<p>All markings, which can be reached from a given marking m by any firing sequence of arbitrary length, constitute the set of <strong>reachable markings</strong> <span class="math inline">\([m⟩\)</span>. For this specific net, the set of reachable markings is straightforward to compute: it consists of all possible triples of elements less than 100 that sum to 100.</p>
<p>A <strong>transition</strong> t is <strong>dead</strong> in the marking m if it is not enabled in any marking <span class="math inline">\(m^{\prime}\)</span> reachable from m: <span class="math inline">\(\nexists m^{\prime} \in [m⟩ : m^{\prime}[t⟩\)</span>. A <strong>transition</strong> t is <strong>live</strong> if it is not dead in any marking reachable from <span class="math inline">\(m_0\)</span>.</p>
<p>A <strong>marking</strong> <span class="math inline">\(m\)</span> is <strong>dead</strong> if there is no transition which is enabled in <span class="math inline">\(m\)</span>.</p>
<p>A nonempty set of places <span class="math inline">\(D \subseteq P\)</span> is called <strong>siphon</strong> if <span class="math inline">\(•D \subseteq D•\)</span> (the set of pretransitions is contained in the set of posttransitions), i.e.&nbsp;every transition which fires tokens onto a place in this structural deadlock set, also has a preplace in this set.</p>
<p>In this particular net, we have: - <span class="math inline">\(•\{P\} = \{Pp\} \subseteq \{P\}•=\{Pp, Ps\} \implies \{P\}\)</span> is a siphon - <span class="math inline">\(•\{R\} = \{Pr\} \subseteq \{R\}•=\{Pr, Pp\} \implies \{R\}\)</span> is a siphon - <span class="math inline">\(•\{S\} = \{Ps\} \subseteq \{S\}•=\{Ps, Pr\} \implies \{S\}\)</span> is a siphon - <span class="math inline">\(•\{R,S\}=\{Pr, Ps\} \subseteq \{R,S\}•=\{Pr, Pp, Ps\} \implies \{R,S\}\)</span> is a siphon - <span class="math inline">\(•\{P, R\} = \{Pp, Pr\} \subseteq \{P, R\}• = \{Pp, Ps, Pr\} \implies \{P, R\}\)</span> is a siphon - <span class="math inline">\(•\{P, S\} = \{Pp, Ps\} \subseteq \{P, S\}• = \{Pp, Ps, Pr\} \implies \{P, S\}\)</span> is a siphon - <span class="math inline">\(•\{P, R, S\} = \{Pp, Pr, Ps\} = \{P, R, S\}• = \{Pp, Pr, Ps\} \implies \{P, R, S\}\)</span> is a siphon</p>
<p>Once a siphon becomes empty (i.e., contains no tokens), it cannot be refilled with tokens by the firing of any transitions (i.e.&nbsp;such part of the system becomes permanently disabled). This means that once a species (or a couple of species) goes extinct, it cannot be reintroduced in the system.</p>
<p>A siphon is minimal if it does not properly contain a non-empty siphon.</p>
<p>In this particular net, <span class="math inline">\(\{P\}, \{R\}, \{S\}\)</span> are minimal siphons.</p>
<p>Checking the file containing the minimal siphons computed by Charlie:</p>
<div class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>cat ..<span class="op">/</span>results<span class="op">/</span>rsp_DLS.res</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> minimal proper siphon ( place )= 

1   |0.P    :1
2   |1.R    :1
3   |2.S    :1
@

1| siphon_1| minimal siphon_1
2| siphon_2| minimal siphon_2
3| siphon_3| minimal siphon_3</code></pre>
</div>
</div>
<p>A set of places <span class="math inline">\(Q \subseteq P\)</span> is called <strong>trap</strong> if <span class="math inline">\(Q• \subseteq •Q\)</span> (the set of posttransitions is contained in the set of pretransitions), i.e.&nbsp;every transition which subtracts tokens from a place of the trap set, also has a postplace in this set.</p>
<p>In this particular net, we have: - <span class="math inline">\(\{P\}•=\{Pp, Ps\} \nsubseteq •\{P\} = \{Pp\}\implies \{P\}\)</span> is not a trap - <span class="math inline">\(\{R\}•=\{Pr, Pp\} \nsubseteq •\{R\} = \{Pr\} \implies \{R\}\)</span> is not a trap - <span class="math inline">\(\{S\}•=\{Ps, Pr\} \nsubseteq •\{S\} = \{Ps\} \implies \{S\}\)</span> is not a trap - <span class="math inline">\(\{R,S\}•=\{Pr, Pp, Ps\} \nsubseteq •\{R,S\}=\{Pr, Ps\} \implies \{R,S\}\)</span> is not a trap - <span class="math inline">\(\{P, R\}• = \{Pp, Ps, Pr\} \nsubseteq •\{P, R\} = \{Pp, Pr\} \implies \{P, R\}\)</span> is not a trap - <span class="math inline">\(\{P, S\}• = \{Pp, Ps, Pr\} \nsubseteq •\{P, S\} = \{Pp, Ps\} \implies \{P, S\}\)</span> is not a trap - <span class="math inline">\(\{P, R, S\}• = \{Pp, Pr, Ps\} = •\{P, R, S\} = \{Pp, Pr, Ps\} \implies \{P, R, S\}\)</span> is a trap</p>
<p>A trap is minimal if it does not properly contain a non-empty trap.</p>
<p>In this particular net, <span class="math inline">\(\{P, R, S\}\)</span> is a minimal trap.</p>
<p>Checking the file containing the minimal traps computed by Charlie:</p>
<div class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>cat ..<span class="op">/</span>results<span class="op">/</span>rsp_TPS.res</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> minimal traps ( place )= 

1   |0.P    :1,
    |1.R    :1,
    |2.S    :1</code></pre>
</div>
</div>
<p>The “Net Properties” dialog in Charlie provides an overview of the key properties of the net. For this particular net, they are shown below:</p>
<p><img align="center" src="../results/petri_net_props.png" width="400px"></p>
<p>The properties are described in the following Table (sourced from [2]).</p>
<table class="table">
<colgroup>
<col style="width: 12%">
<col style="width: 38%">
<col style="width: 40%">
<col style="width: 9%">
</colgroup>
<thead>
<tr class="header">
<th>Abbreviation</th>
<th>Name</th>
<th>Description</th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>PUR</td>
<td>pure</td>
<td><span class="math inline">\(\forall x, y \in P \cup T : f (x, y) \neq 0 \implies f (y, x) = 0\)</span>, i.e.&nbsp;there are no two nodes, connected in both directions. This precludes read arcs. Then the net structure is fully represented by the incidence matrix, which is used for the calculation of the P- and T-invariants.</td>
<td>❌</td>
</tr>
<tr class="even">
<td>ORD</td>
<td>ordinary</td>
<td><span class="math inline">\(\forall x, y \in P \cup T : f (x, y) \neq 0 \implies f (x, y) = 1\)</span>, i.e.&nbsp;all arc weights are equal to 1. This includes homogeneity. A non-ordinary Petri net cannot be live and 1-bounded at the same time.</td>
<td>❌</td>
</tr>
<tr class="odd">
<td>HOM</td>
<td>homogeneous</td>
<td><span class="math inline">\(\forall p \in P :t,t^{\prime} \in p• \implies f(p,t)=f(p,t^{\prime})\)</span>, i.e.&nbsp;all outgoing arcs of a given place have the same multiplicity.</td>
<td>✅</td>
</tr>
<tr class="even">
<td>NBM</td>
<td>non blocking multiplicity</td>
<td>A net has non-blocking multiplicity if <span class="math inline">\(\forall p \in P :•p \neq \emptyset \land min\{f(t,p)\vert \forall t \in •p\}\geq max\{f(p,t)\vert \forall t \in p•\}\)</span>, i.e.&nbsp;an input place causes blocking multiplicity. Otherwise, it must hold for each place: the minimum of the multiplicities of the incoming arcs is not less than the maximum of the multiplicities of the outgoing arcs.</td>
<td>✅</td>
</tr>
<tr class="odd">
<td>CSV</td>
<td>conservative</td>
<td>A Petri net is conservative if <span class="math inline">\(\forall t \in T : \sum_{p \in •t} f(p,t) = \sum_{p \in t•} f(t,p)\)</span> i.e.&nbsp;all transitions add exactly as many tokens to their postplaces as they subtract from their preplaces, or briefly, all transitions fire token-preservingly. A conservative Petri net is structurally bounded.</td>
<td>✅</td>
</tr>
<tr class="even">
<td>SCF</td>
<td>structurally conflict free</td>
<td>A Petri net is static (or structurally) conflict free if <span class="math inline">\(\forall t,t^{\prime} \in T :t \neq t^{\prime} \implies •t \cap •t^{\prime} = \emptyset\)</span>, i.e.&nbsp;there are no two transitions sharing a preplace. Transitions involved in a static conflict compete for the tokens on shared preplaces. Thus, static conflicts indicate situations where dynamic conflicts, i.e.&nbsp;nondeterministic choices, may occur in the system behaviour. However, it depends on the token situation whether a conflict does actually occur dynamically. There is no nondeterminism in SCF nets.</td>
<td>❌</td>
</tr>
<tr class="odd">
<td>FT0</td>
<td>every transition has a pre-place</td>
<td><span class="math inline">\(\forall t: •t \neq \emptyset\)</span></td>
<td>✅</td>
</tr>
<tr class="even">
<td>TF0</td>
<td>every transition has a post-place</td>
<td><span class="math inline">\(\forall t: t• \neq \emptyset\)</span></td>
<td>✅</td>
</tr>
<tr class="odd">
<td>FP0</td>
<td>every place has a pre-transition</td>
<td><span class="math inline">\(\forall p: •p \neq \emptyset\)</span></td>
<td>✅</td>
</tr>
<tr class="even">
<td>PF0</td>
<td>every place has a post-transition</td>
<td><span class="math inline">\(\forall p: p• \neq \emptyset\)</span></td>
<td>✅</td>
</tr>
<tr class="odd">
<td>CON</td>
<td>connected</td>
<td>A Petri net is connected if it holds for every two nodes <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span> that there is an undirected path between <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span>. Disconnected parts of a Petri net cannot influence each other, so they can usually be analysed separately.</td>
<td>✅</td>
</tr>
<tr class="even">
<td>SC</td>
<td>strongly connected</td>
<td>A Petri net is strongly connected if it holds for every two nodes <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span> that there is a directed path from <span class="math inline">\(a\)</span> to <span class="math inline">\(b\)</span>. Strong connectedness involves connectedness and the absence of boundary nodes. It is a necessary condition for a Petri net to be live and bounded at the same time.</td>
<td>✅</td>
</tr>
<tr class="odd">
<td>NC</td>
<td>netclass</td>
<td>The net structure class: 1) A Petri net is called State Machine (SM) if <span class="math inline">\(\forall t\in T :\vert •t \vert =\vert t•\vert \leq 1\)</span>, i.e.&nbsp;there are neither forward branching nor backward branching transitions. 2) A Petri net is called Synchronisation Graph (SG) if <span class="math inline">\(\forall p\in P :\vert •p\vert =\vert p•\vert \leq 1\)</span>, i.e.&nbsp;there are neither forward branching nor backward branching places. 3) A Petri net is called Extended Free Choice (EFC) if <span class="math inline">\(\forall p,q\in P:p• ∩q• =\emptyset \lor p• =q•\)</span>, i.e.&nbsp;transitions in conflict have identical sets of preplaces. 4) A Petri net is called Extended Simple (ES) if <span class="math inline">\(\forall p,q\in P:p• \cap q• =\emptyset \lor p• \subseteq q• \lor q• \subseteq p•\)</span>, i.e.&nbsp;every transition is involved in one conflict at most. 5) If the net does not comply to any of the introduced net structure classes, it is said to be not Extended Simple (nES).</td>
<td>nES</td>
</tr>
<tr class="even">
<td>RKTH</td>
<td>rank theorem</td>
<td><span class="math inline">\(rank(IM) \neq \vert SCCS\vert - 1 \implies !RKTH\)</span>, i.e.&nbsp;if the rank of the incidence matrix is not equal to the number of strongly connected components (maximal sets of strongly connected nodes) minus one, then the rank theorem does not hold.</td>
<td>❌</td>
</tr>
<tr class="odd">
<td>STP</td>
<td>siphon trap property</td>
<td>The siphon trap property holds if no siphons are bad. A siphon is called bad if it does not include a trap.</td>
<td>❌</td>
</tr>
<tr class="even">
<td>CPI</td>
<td>covered by P-invariants</td>
<td>A net is covered by P-invariants, shortly CPI, if every place belongs to a P-invariant.</td>
<td>✅</td>
</tr>
<tr class="odd">
<td>CTI</td>
<td>covered by T-invariants</td>
<td>A net is covered by T-invariants, shortly CTI, if every transition belongs to a T-invariant.</td>
<td>✅</td>
</tr>
<tr class="even">
<td>SCTI</td>
<td>strongly covered by T-invariants</td>
<td>The two transitions modelling the two directions of a reversible reaction always make a minimal T-invariant and they are called trivial T-invariants. A net which is covered by nontrivial T-invariants is said to be strongly covered by T-invariants.</td>
<td>✅</td>
</tr>
<tr class="odd">
<td>SB</td>
<td>structurally bounded</td>
<td>A net is structurally bounded if it is bounded for any initial marking</td>
<td>✅</td>
</tr>
<tr class="even">
<td>k-B</td>
<td>k-bounded</td>
<td>A place <span class="math inline">\(p\)</span> is k-bounded (bounded for short) if there exists a positive integer number <span class="math inline">\(k\)</span>, which represents an upper bound for the number of tokens on this place in all reachable markings of the Petri net: <span class="math inline">\(\exists k \in \mathbb{N}_0 :\forall m\in [m_0⟩:m(p)\leq k\)</span>. A Petri net is k-bounded (bounded for short) if all its places are k-bounded.</td>
<td>100</td>
</tr>
<tr class="odd">
<td>DCF</td>
<td>dynamically conflict free</td>
<td>Dynamic conflict is a behavioural property which refers to a marking enabling two transitions, but the firing of one transition disables the other one. The occurrence of dynamic conflicts causes alternative (branching) system behaviour, whereby the decision between these alternatives is taken nondeterministically.</td>
<td>❌</td>
</tr>
<tr class="even">
<td>DSt</td>
<td>no dead state(s)</td>
<td>True if the net does not have dead states (markings).</td>
<td>3</td>
</tr>
<tr class="odd">
<td>DTr</td>
<td>no dead transition(s)</td>
<td>If the net does not have dead transitions at the initial state.</td>
<td>✅</td>
</tr>
<tr class="even">
<td>LIV</td>
<td>live</td>
<td>A Petri net is live (strongly live) if each transition is live.</td>
<td>❌</td>
</tr>
<tr class="odd">
<td>REV</td>
<td>reversible</td>
<td>A Petri net is reversible if the initial marking can be reached again from each reachable marking: <span class="math inline">\(\forall m \in [m_0⟩ : m_0 \in [m⟩\)</span></td>
<td>❌</td>
</tr>
</tbody>
</table>
<p>Charlie checks these properties by applying a set of rules, as shown in the log file generated by the tool:</p>
<div class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>cat ..<span class="op">/</span>results<span class="op">/</span>charlie_log.txt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
starts analysis with following options:
charlie.analyzer.structural.StructuralOptionSet

number of places: 3
number of transitions: 3
number of arcs: 9

input places:
no input places
output places:
no output places
input transitions:
no input transitions
output transitions:
no output transitions

Structural coupled conflict sets: 

1   |0.Pp   :1,
    |1.Pr   :1,
    |2.Ps   :1
 
Structural equal conflict sets: 

1   |0.Pp   :1
2   |1.Pr   :1
3   |2.Ps   :1
 
time:  0 m 0 s



Applying rule:
CSV =&gt; k-B


Applying rule:
CSV =&gt; SB


Applying rule:
SC =&gt; CON


Applying rule:
CSV =&gt; CPI


Applying rule:
CPI =&gt; k-B


Applying rule:
SB =&gt; k-B


Applying rule:
CPI =&gt; SB

Analyzer: Rank of Matrix Analyzer
start time: 19/08/24, 15:09
starts analysis with following options:
charlie.analyzer.invariant.RankIncidenceMatrixOptionSet
Rank of the incidence matrix: 2
time: 00:00:00:013



Applying rule:
rank(IM) != |SCCS| - 1 =&gt; !RKTH

Analyzer: Structurally Bounded Analyzer
start time: 19/08/24, 15:09
starts analysis with following options:
GUI.app_components.StructurallyBoundedOptionSet
time: 00:00:00:013

Analyzer: InvariantAnalyzer
start time: 19/08/24, 15:10
starts analysis with following options:
Invariant Options:
compute: P-Invariants
delete Trivial Invariants: no
check coverage: yes
check extended coverage: no
enable MCSC: no
Invariant Analyzer: computing P-Invariants
minimal semipositive place invariants: 
1
time: 00:00:00:014

Analyzer: InvariantAnalyzer
start time: 19/08/24, 15:10
starts analysis with following options:
Invariant Options:
compute: T-Invariants
delete Trivial Invariants: no
check coverage: yes
check extended coverage: yes
enable MCSC: no
Invariant Analyzer: computing T-Invariants
check coverage:
net is covered by T-Invariants
net does is support strong Coverage by T Invariants
minimal semipositive transition invariants:
1
time: 00:00:00:015

Analyzer: Trap Analyzer
start time: 19/08/24, 15:10
starts analysis with following options:
TrapOptions:
compute: true
export: false
exportFile:  not set!
properSets: false
Trap Analyzer: 
computed minimal traps
    
minimal traps:
1 minimal traps computed in 00:00:00:000
time: 00:00:00:008

Analyzer: Siphon Analyzer
start time: 19/08/24, 15:10
starts analysis with following options:
siphon options
Siphon Analyzer:
 computing siphons

STP is not valid
 counter examples:
    siphon:
    |0.P    :1
    is a bad siphon
1 siphons computed 00:00:00:000
time: 00:00:00:000

Analyzer: RGraph Simple Construction
start time: 19/08/24, 15:14
starts analysis with following options:
used construction options:
firing rule: single
boundedness check: yes
maximal construction depth: none
reduction: none
initial marking:(P: 20 | R: 50 | S: 30)
reachability graph analyzer:
computing rechability graph using simple  firing rule
transition not live:
    |0.Pp   :1,
    |1.Pr   :1,
    |2.Ps   :1
transition dead at m0:
    empty set
the net is not live
is not persistent
the net is not safe
number of dead states: 3
filter for dead states: 
dead state 1: P== 100
dead state 2: R== 100
dead state 3: S== 100
-- reachability graph constructed in 00:00:52:162--
used construction options:
firing rule: single
boundedness check: yes
maximal construction depth: none
reduction: none
initial marking:(P: 20 | R: 50 | S: 30)
states: 5151
bound: 100
edges: 14850
#scc: 301
#terminal scc: 3
time: 00:00:52:162



Applying rule:
DSt =&gt; !LIV



Results:
PUR   ORD   HOM   NBM   CSV   SCF   FT0   TF0   FP0   PF0   CON   SC    NC  
   N     N     Y     Y     Y     N     Y     Y     Y     Y     Y     Y    nES 
 RKTH   STP   CPI   CTI  SCTI    SB   k-B   1-B   DCF   DSt   DTr   LIV   REV 
   N     N     Y     Y     Y     Y    100    N     N      3    Y     N     N  
  SSI   RNK  SCCS  SEQS                                                       
   Y      2     1     3</code></pre>
</div>
</div>
<p>Since a stochastic Petri net can be translated into a CTMC, Charlie provides the possibility to export the net in the PRISM input language. Let’s check whether the PRISM model produced by Charlie corresponds to the one we manually created:</p>
<div class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>cat ..<span class="op">/</span>long_range_models<span class="op">/</span>rsp.sm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>//created by Snoopy 2
//date: Sun Aug 18 14:58:29 2024

ctmc

const int Max;
const int N;
module  rsp

S:  [ 0..Max ]  init 30*N;
R:  [ 0..Max ]  init 50*N;
P:  [ 0..Max ]  init 20*N;


[Pp]
(P &gt; 0) &amp; (R &gt; 0)
 -&gt; (0.3) * P * R : 
(P' = P+1) &amp; (R' = R-1);


[Pr]
(R &gt; 0) &amp; (S &gt; 0)
 -&gt; (0.2) * R * S : 
(R' = R+1) &amp; (S' = S-1);


[Ps]
(P &gt; 0) &amp; (S &gt; 0)
 -&gt; (0.5) * S * P : 
(P' = P-1) &amp; (S' = S+1);





endmodule</code></pre>
</div>
</div>
<p>Aside from the missing constraints on the variables’ maximum values, the model is identical to the one we manually created.</p>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">6. References</h2>
<ul>
<li>[1] Frean, Marcus, and Edward R. Abraham. “Rock–scissors–paper and the survival of the weakest.” Proceedings of the Royal Society of London. Series B: Biological Sciences 268.1474 (2001): 1323-1327.</li>
<li>[2] Heiner, Monika, David Gilbert, and Robin Donaldson. “Petri nets for systems and synthetic biology.” International school on formal methods for the design of computer, communication and software systems. Berlin, Heidelberg: Springer Berlin Heidelberg, 2008. 215-264.</li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>