<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Computational Models for Complex system - Negative feedback loop</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Computational Models for Complex system</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/iretes/rock-scissors-paper" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#chemical-reaction-model" id="toc-chemical-reaction-model" class="nav-link active" data-scroll-target="#chemical-reaction-model">Chemical reaction model</a></li>
  <li><a href="#ode-model" id="toc-ode-model" class="nav-link" data-scroll-target="#ode-model">ODE model</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Negative feedback loop</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>Importing the necessary libraries:</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> stochpy</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.integrate <span class="im">import</span> odeint</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
#######################################################################
#                                                                     #
#            Welcome to the interactive StochPy environment           #
#                                                                     #
#######################################################################
#  StochPy: Stochastic modeling in Python                             #
#  http://stochpy.sourceforge.net                                     #
#  Copyright(C) T.R Maarleveld, B.G. Olivier, F.J Bruggeman 2010-2015 #
#  DOI: 10.1371/journal.pone.0079345                                  #
#  Email: tmd200@users.sourceforge.net                                #
#  VU University, Amsterdam, Netherlands                              #
#  Centrum Wiskunde Informatica, Amsterdam, Netherlands               #
#  StochPy is distributed under the BSD licence.                      #
#######################################################################

Version 2.4.0
Output Directory: /Users/irenetesta/Stochpy
Model Directory: /Users/irenetesta/Stochpy/pscmodels</code></pre>
</div>
</div>
<section id="chemical-reaction-model" class="level2">
<h2 class="anchored" data-anchor-id="chemical-reaction-model">Chemical reaction model</h2>
<span class="math display">\[\begin{cases}
G_1 \xrightarrow{r_{P_1}} G_1 + P_1\\
G_2 \xrightarrow{r_{P_2}} G_2 + P_2\\
G_3 \xrightarrow{r_{P_3}} G_3 + P_3\\
P_1 + G_2 \underset{r_{U_1}}{\xrightleftharpoons{r_{B_1}}} P_1G_2\\
P_2 + G_3 \underset{r_{U_2}}{\xrightleftharpoons{r_{B_2}}} P_2G_3\\
P_3 + G_1 \underset{r_{U_3}}{\xrightleftharpoons{r_{B_3}}} P_3G_1\\
P_1 \xrightarrow{r_{D_1}}\\
P_2 \xrightarrow{r_{D_2}}\\
P_3 \xrightarrow{r_{D_3}}\\
\end{cases}\]</span>
<p>StochPy uses the <a href="https://stochpy.sourceforge.net/html/inputfile_doc.html#pysces-inputfile">PySCeS MDL</a>, an ASCII text based input file to describe a system in terms of itâ€™s stoichiometry, kinetics, compartments and parameters. We defined the system using such format and saved it in the file <code>../long_range_models/negative_feedback_loop.psc</code>:</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>cat ..<span class="op">/</span>long_range_models<span class="op">/</span>negative_feedback_loop.psc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Negative feedback loop

# G1 --&gt; 10, G1 + P1
# G2 --&gt; 10000, G2 + P2
# G3 --&gt; 10, G3 + P3
# P1 + G2, 2 &lt;--&gt; 10, P1G2
# P2 + G3, 20 &lt;--&gt; 0.1, P2G3
# P3 + G1, 20 &lt;--&gt; 10, P3G1
# P1 --&gt; 1,
# P2 --&gt; 100,
# P3 --&gt; 1,

R1:
    G1 &gt; G1 + P1
    G1*RP1

R2:
    G2 &gt; G2 + P2
    G2*RP2

R3:
    G3 &gt; G3 + P3
    G3*RP3

R4:
    P1 + G2 &gt; P1G2
    P1*G2*RB1

R5:
    P1G2 &gt; P1 + G2
    P1G2*RU1

R6:
    P2 + G3 &gt; P2G3
    P2*G3*RB2

R7:
    P2G3 &gt; P2 + G3
    P2G3*RU2

R8:
    P3 + G1 &gt; P3G1
    P3*G1*RB3

R9:
    P3G1 &gt; P3 + G1
    P3G1*RU3

R10:
    P1 &gt; $pool
    P1*RD1

R11:
    P2 &gt; $pool
    P2*RD2

R12:
    P3 &gt; $pool
    P3*RD3

# Parameters
RP1 = 10
RP2 = 10000
RP3 = 10
RB1 = 10
RU1 = 2
RB2 = 0.1
RU2 = 20
RB3 = 10
RU3 = 20
RD1 = 1
RD2 = 100
RD3 = 1

# Init Values
P1 = 0
P2 = 0
P3 = 0
G1 = 1
G2 = 1
G3 = 1
P1G2 = 0
P2G3 = 0
P3G1 = 0</code></pre>
</div>
</div>
<p>Loading the model:</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>smod <span class="op">=</span> stochpy.SSA(IsQuiet<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>smod.Model(model_file<span class="op">=</span><span class="st">"negative_feedback_loop.psc"</span>,<span class="bu">dir</span><span class="op">=</span><span class="st">"../long_range_models/"</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>smod.ShowSpecies()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Info: Direct method is selected to perform stochastic simulations.
Parsing file: /Users/irenetesta/Stochpy/pscmodels/ImmigrationDeath.psc
Info: No reagents have been fixed
Parsing file: ../long_range_models/negative_feedback_loop.psc
Info: No reagents have been fixed
['G1', 'P1', 'G2', 'P2', 'G3', 'P3', 'P1G2', 'P2G3', 'P3G1']</code></pre>
</div>
</div>
<p>The method to perform a stochastic simulation is <code>DoStochSim</code>:</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="bu">help</span>(smod.DoStochSim)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Help on method DoStochSim in module stochpy.modules.StochSim:

DoStochSim(end=False, mode=False, method=False, trajectories=False, epsilon=0.03, IsTrackPropensities=False, rate_selection=None, species_selection=None, IsOnlyLastTimepoint=False, critical_reactions=[], reaction_orders=False, species_HORs=False, species_max_influence=False, quiet=False) method of stochpy.modules.StochSim.SSA instance
    Run a stochastic simulation for until `end` is reached. This can be either time steps or end time (which could be a *HUGE* number of steps).
    
    Input:
     - *end* [default=1000] (float) simulation end (steps or time)
     - *mode* [default='steps'] (string) simulation mode, can be one of: ['steps','time']
     - *method* [default='Direct'] (string) stochastic algorithm ['Direct', 'FRM', 'NRM', 'TauLeap']
     - *trajectories* [default = 1] (integer)
     - *epsilon* [default = 0.03] (float) parameter for the tau-leap method
     - *IsTrackPropensities* [default = False]
     - *rate_selection* [default = None] (list) of names of rates to store. This saves memory space and prevents Memory Errors when propensities propensities are tracked
     - *species_selection* [default = None] (list) of names of species to store. This saves memory space and prevents Memory Errors (occurring at ~15 species).
     - *IsOnlyLastTimepoint* [default = False] (boolean)
     - *critical_reactions* [default = [] ] (list) ONLY for the tau-leaping method where the user can pre-define reactions that are "critical". Critical reactions can fire only once per time step.
     - *reaction_orders* [default = [] (list) ONLY for the tau-leaping method 
     - *species_HORs* [default = []  (list) ONLY for the tau-leaping method 
     - *species_max_influence* [default = []]  (list) ONLY for the tau-leaping method 
     - *quiet* [default = False] suppress print statements
</code></pre>
</div>
</div>
<p>In the following, we will only use the Direct method as its variants are designed to reduce computational costs, which is not a concern for the simulations we will perform.</p>
<p>Performing a stochastic simulation using default parameters:</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>smod.DoStochSim(IsTrackPropensities<span class="op">=</span><span class="va">True</span>, end<span class="op">=</span><span class="dv">10000</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>species_df <span class="op">=</span> pd.DataFrame(smod.data_stochsim.species, columns<span class="op">=</span>smod.data_stochsim.species_labels)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>species_df[[<span class="st">'P1'</span>, <span class="st">'P2'</span>, <span class="st">'P3'</span>]].plot(figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">5</span>), color<span class="op">=</span>[<span class="st">'red'</span>, <span class="st">'green'</span>, <span class="st">'blue'</span>], xlabel<span class="op">=</span><span class="st">"Steps"</span>, ylabel<span class="op">=</span><span class="st">"Copy number"</span>, title<span class="op">=</span><span class="st">"Proteins"</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>species_df[[<span class="st">'P3G1'</span>, <span class="st">'G1'</span>]].plot(figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">5</span>), color<span class="op">=</span>[<span class="st">'black'</span>, <span class="st">'darkturquoise'</span>], xlabel<span class="op">=</span><span class="st">"Steps"</span>, ylabel<span class="op">=</span><span class="st">"Copy number"</span>, title<span class="op">=</span><span class="st">"G1 inhibition"</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>species_df[[<span class="st">'P1G2'</span>, <span class="st">'G2'</span>]].plot(figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">5</span>), color<span class="op">=</span>[<span class="st">'black'</span>, <span class="st">'magenta'</span>], xlabel<span class="op">=</span><span class="st">"Steps"</span>, ylabel<span class="op">=</span><span class="st">"Copy number"</span>, title<span class="op">=</span><span class="st">"G2 inhibition"</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>species_df[[<span class="st">'P2G3'</span>, <span class="st">'G3'</span>]].plot(figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">5</span>), color<span class="op">=</span>[<span class="st">'black'</span>, <span class="st">'gold'</span>], xlabel<span class="op">=</span><span class="st">"Steps"</span>, ylabel<span class="op">=</span><span class="st">"Copy number"</span>, title<span class="op">=</span><span class="st">"G3 inhibition"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Info: 1 trajectory is generated
simulation done!               
Info: Number of time steps 10000 End time 2.5555813664087736
Info: Simulation time 0.12183</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>&lt;Axes: title={'center': 'G3 inhibition'}, xlabel='Steps', ylabel='Copy number'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="negative_feedback_loop_files/figure-html/cell-6-output-3.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="negative_feedback_loop_files/figure-html/cell-6-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="negative_feedback_loop_files/figure-html/cell-6-output-5.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="negative_feedback_loop_files/figure-html/cell-6-output-6.png" class="img-fluid"></p>
</div>
</div>
<p>Visualizing reaction propensities:</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>propensities_df <span class="op">=</span> pd.DataFrame(smod.data_stochsim.propensities, columns<span class="op">=</span>smod.data_stochsim.propensities_labels)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>propensities_df[[<span class="st">'R1'</span>, <span class="st">'R2'</span>, <span class="st">'R3'</span>]].plot(figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">5</span>), color<span class="op">=</span>[<span class="st">'red'</span>, <span class="st">'green'</span>, <span class="st">'blue'</span>], xlabel<span class="op">=</span><span class="st">"Steps"</span>, ylabel<span class="op">=</span><span class="st">"Propensity"</span>, title<span class="op">=</span><span class="st">"Protein production"</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>propensities_df[[<span class="st">'R4'</span>, <span class="st">'R6'</span>, <span class="st">'R8'</span>]].plot(figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">5</span>), color<span class="op">=</span>[<span class="st">'magenta'</span>, <span class="st">'gold'</span>, <span class="st">'darkturquoise'</span>], xlabel<span class="op">=</span><span class="st">"Steps"</span>, ylabel<span class="op">=</span><span class="st">"Propensity"</span>, title<span class="op">=</span><span class="st">"Gene inhibition"</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>propensities_df[[<span class="st">'R5'</span>, <span class="st">'R7'</span>, <span class="st">'R9'</span>]].plot(figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">5</span>), color<span class="op">=</span>[<span class="st">'magenta'</span>, <span class="st">'gold'</span>, <span class="st">'darkturquoise'</span>], xlabel<span class="op">=</span><span class="st">"Steps"</span>, ylabel<span class="op">=</span><span class="st">"Propensity"</span>, title<span class="op">=</span><span class="st">"Gene disinhibition"</span>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>propensities_df[[<span class="st">'R10'</span>, <span class="st">'R11'</span>, <span class="st">'R12'</span>]].plot(figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">5</span>), color<span class="op">=</span>[<span class="st">'red'</span>, <span class="st">'green'</span>, <span class="st">'blue'</span>], xlabel<span class="op">=</span><span class="st">"Steps"</span>, ylabel<span class="op">=</span><span class="st">"Propensity"</span>, title<span class="op">=</span><span class="st">"Protein degradation"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>&lt;Axes: title={'center': 'Protein degradation'}, xlabel='Steps', ylabel='Propensity'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="negative_feedback_loop_files/figure-html/cell-7-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="negative_feedback_loop_files/figure-html/cell-7-output-3.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="negative_feedback_loop_files/figure-html/cell-7-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="negative_feedback_loop_files/figure-html/cell-7-output-5.png" class="img-fluid"></p>
</div>
</div>
<p>Plotting the time between two subsequent firings of a reaction:</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="bu">help</span>(smod.PlotWaitingtimesDistributions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Help on method PlotWaitingtimesDistributions in module stochpy.modules.StochPyPlot:

PlotWaitingtimesDistributions(rates2plot=True, linestyle='None', linewidth=1, marker='o', colors=None, title='', xlabel='inter-event time $t$', ylabel='PDF', IsLegend=True, legend_location='upper right') method of stochpy.modules.StochSim.SSA instance
    Plot event waiting time distributions            
    
    Input:
     - *rates2plot* [default = True]  as a list of strings ["R1","R2"]
     - *linestyle* [default = 'None'] dashed, dotted, dash_dot, and solid (string)
     - *linewidth* [default = 1] (float)
     - *marker* [default = 'o'] ('v','o','s',',','*','.')
     - *colors* [default =  None] (list)
     - *title* [default = ''] (string)
     - *xlabel* [default = 'inter-event time t'] (string)
     - *ylabel* [default = 'PDF'] (string)
     - *IsLegend* [default = True] (boolean)
     - *legend_location* [default = 'upper right'] (string/integer)
</code></pre>
</div>
</div>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>smod.PlotWaitingtimesDistributions(rates2plot<span class="op">=</span>[<span class="st">'R1'</span>, <span class="st">'R2'</span>, <span class="st">'R3'</span>], colors<span class="op">=</span>[<span class="st">'red'</span>, <span class="st">'green'</span>, <span class="st">'blue'</span>], xlabel<span class="op">=</span><span class="st">"Steps"</span>, ylabel<span class="op">=</span><span class="st">"Propensity"</span>, title<span class="op">=</span><span class="st">"Protein production"</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>smod.PlotWaitingtimesDistributions(rates2plot<span class="op">=</span>[<span class="st">'R4'</span>, <span class="st">'R6'</span>, <span class="st">'R8'</span>], colors<span class="op">=</span>[<span class="st">'magenta'</span>, <span class="st">'gold'</span>, <span class="st">'darkturquoise'</span>], xlabel<span class="op">=</span><span class="st">"Steps"</span>, ylabel<span class="op">=</span><span class="st">"Propensity"</span>, title<span class="op">=</span><span class="st">"Gene inhibition"</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>smod.PlotWaitingtimesDistributions(rates2plot<span class="op">=</span>[<span class="st">'R5'</span>, <span class="st">'R7'</span>, <span class="st">'R9'</span>], colors<span class="op">=</span>[<span class="st">'magenta'</span>, <span class="st">'gold'</span>, <span class="st">'darkturquoise'</span>], xlabel<span class="op">=</span><span class="st">"Steps"</span>, ylabel<span class="op">=</span><span class="st">"Propensity"</span>, title<span class="op">=</span><span class="st">"Gene disinhibition"</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>smod.PlotWaitingtimesDistributions(rates2plot<span class="op">=</span>[<span class="st">'R10'</span>, <span class="st">'R11'</span>, <span class="st">'R12'</span>], colors<span class="op">=</span>[<span class="st">'red'</span>, <span class="st">'green'</span>, <span class="st">'blue'</span>], xlabel<span class="op">=</span><span class="st">"Steps"</span>, ylabel<span class="op">=</span><span class="st">"Propensity"</span>, title<span class="op">=</span><span class="st">"Protein degradation"</span>)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>smod.PrintWaitingtimesMeans()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reaction    Mean
R1  0.469
R2  5.142e-04
R3  0.071
R4  0.457
R5  0.497
R6  0.786
R7  0.784
R8  0.072
R9  0.071
R10 0.331
R11 5.239e-04
R12 0.121</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="negative_feedback_loop_files/figure-html/cell-9-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="negative_feedback_loop_files/figure-html/cell-9-output-3.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="negative_feedback_loop_files/figure-html/cell-9-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="negative_feedback_loop_files/figure-html/cell-9-output-5.png" class="img-fluid"></p>
</div>
</div>
<p>To approximate the deterministic behavior we can either perform multiple stochastic simulations and average the species copy numbers at each time point:</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>smod.DoStochSim(end<span class="op">=</span><span class="dv">100</span>, trajectories<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>smod.GetRegularGrid(n_samples<span class="op">=</span><span class="dv">50</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>smod.PlotAverageSpeciesTimeSeries(species2plot<span class="op">=</span>[<span class="st">'P1'</span>, <span class="st">'P2'</span>, <span class="st">'P3'</span>], colors<span class="op">=</span>[<span class="st">'red'</span>, <span class="st">'green'</span>, <span class="st">'blue'</span>], xlabel<span class="op">=</span><span class="st">"Steps"</span>, ylabel<span class="op">=</span><span class="st">"Copy number"</span>, title<span class="op">=</span><span class="st">"Proteins"</span>)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>smod.PlotAverageSpeciesTimeSeries(species2plot<span class="op">=</span>[<span class="st">'P3G1'</span>, <span class="st">'G1'</span>], colors<span class="op">=</span>[<span class="st">'black'</span>, <span class="st">'cyan'</span>], xlabel<span class="op">=</span><span class="st">"Steps"</span>, ylabel<span class="op">=</span><span class="st">"Copy number"</span>, title<span class="op">=</span><span class="st">"G1 inhibition"</span>)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>smod.PlotAverageSpeciesTimeSeries(species2plot<span class="op">=</span>[<span class="st">'P1G2'</span>, <span class="st">'G2'</span>], colors<span class="op">=</span>[<span class="st">'black'</span>, <span class="st">'magenta'</span>], xlabel<span class="op">=</span><span class="st">"Steps"</span>, ylabel<span class="op">=</span><span class="st">"Copy number"</span>, title<span class="op">=</span><span class="st">"G2 inhibition"</span>)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>smod.PlotAverageSpeciesTimeSeries(species2plot<span class="op">=</span>[<span class="st">'P2G3'</span>, <span class="st">'G3'</span>], colors<span class="op">=</span>[<span class="st">'black'</span>, <span class="st">'gold'</span>], xlabel<span class="op">=</span><span class="st">"Steps"</span>, ylabel<span class="op">=</span><span class="st">"Copy number"</span>, title<span class="op">=</span><span class="st">"G3 inhibition"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Info: 100 trajectories are generated
Info: Time simulation output of the trajectories is stored at negative_feedback_loop(trajectory).dat in directory: /Users/irenetesta/Stochpy/temp
Info: Simulation time: 0.16893577575683594                                                   </code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="negative_feedback_loop_files/figure-html/cell-10-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="negative_feedback_loop_files/figure-html/cell-10-output-3.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="negative_feedback_loop_files/figure-html/cell-10-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="negative_feedback_loop_files/figure-html/cell-10-output-5.png" class="img-fluid"></p>
</div>
</div>
<p>Computing mean and standard deviation of the species copy number is not straightforward as the time between two events is not constant, thus it is necessary to track the time spent in each state for each species. This computation is implemented by the following functions:</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>smod.PrintSpeciesMeans()</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>smod.PrintSpeciesStandardDeviations()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Species Mean
G1  1.000
P1  0.000e+00
G2  1.000
P2  32.852
G3  1.000
P3  0.000e+00
P1G2    0.000e+00
P2G3    0.000e+00
P3G1    0.000e+00
Species Standard Deviation
G1  0.000e+00
P1  0.000e+00
G2  0.000e+00
P2  15.813
G3  0.000e+00
P3  0.000e+00
P1G2    0.000e+00
P2G3    0.000e+00
P3G1    0.000e+00</code></pre>
</div>
</div>
<p>To get an accurate prediction of the species distribution StochPy provides the function <code>DoCompleteStochSim()</code> that continues the simulation until the first four moments converge within a user-specified error:</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># smod.DoCompleteStochSim()</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co"># smod.PlotSpeciesDistributions()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ode-model" class="level2">
<h2 class="anchored" data-anchor-id="ode-model">ODE model</h2>
<span class="math display">\[\begin{cases}
\frac{\partial G_1}{\partial t}=-r_{B_3} \cdot P_3\cdot G_1 + r_{U_3} \cdot P_3G_1\\
\frac{\partial G_2}{\partial t}=-r_{B_1} \cdot P_1\cdot G_2 + r_{U_1} \cdot P_1G_2\\
\frac{\partial G_3}{\partial t}=-r_{B_2} \cdot P_2\cdot G_3 + r_{U_2} \cdot P_2G_3\\\
\frac{\partial P_1}{\partial t}=r_{P_1}\cdot G_1 - r_{B_1} \cdot P_1\cdot G_2 + r_{U_1}\cdot P_1G_2 - r_{D_1}\cdot P_1\\
\frac{\partial P_2}{\partial t}=r_{P_2}\cdot G_2- r_{B_2}\cdot P_2\cdot G_3+r_{U_2}\cdot P_2G_3-r_{D_2}\cdot P_2\\
\frac{\partial P_3}{\partial t}=r_{P_3}\cdot G_3- r_{B_3}\cdot P_3\cdot G_1 +r_{U_3} \cdot P_3G_1-r_{D_3}\cdot P_3\\
\frac{\partial P_1G_2}{\partial t}=r_{B_1}\cdot P_1\cdot G_2 - r_{U_1} \cdot P_1G_2\\
\frac{\partial P_2G_3}{\partial t}=r_{B_2}\cdot P_2\cdot G_3 - r_{U_2}\cdot P_2G_3\\
\frac{\partial P_3G_1}{\partial t}=r_{B_3}\cdot P_3\cdot G_1 - r_{U_3} \cdot P_3G_1\\
\end{cases}\]</span>
<p>ial P_3G_1}{t}=r_{B_3}P_3G_1 - r_{U_3} P_3G_1\ \end{cases}</p>
<p>The <code>odeint</code> method from <code>scipy.integrate</code> solves a system of ordinary differential equations using lsoda from the FORTRAN library odepack. This library uses the Adams/BDF method with automatic stiffness detection and switching.</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ODE_solver(t, rates, init):</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">'''</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Solve the initial value problem for the ODE system.</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co">    '''</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> neg_feedback_loop(x0, t, rates):</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>        G1, G2, G3, P1, P2, P3, P1G2, P2G3, P3G1 <span class="op">=</span> x0</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>        d_G1_dt <span class="op">=</span> <span class="op">-</span>rates[<span class="st">'rB3'</span>]<span class="op">*</span>P3<span class="op">*</span>G1 <span class="op">+</span> rates[<span class="st">'rU3'</span>]<span class="op">*</span>P3G1</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>        d_G2_dt <span class="op">=</span> <span class="op">-</span>rates[<span class="st">'rB1'</span>]<span class="op">*</span>P1<span class="op">*</span>G2 <span class="op">+</span> rates[<span class="st">'rU1'</span>]<span class="op">*</span>P1G2</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>        d_G3_dt <span class="op">=</span> <span class="op">-</span>rates[<span class="st">'rB2'</span>]<span class="op">*</span>P2<span class="op">*</span>G3 <span class="op">+</span> rates[<span class="st">'rU2'</span>]<span class="op">*</span>P2G3</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>        d_P1_dt <span class="op">=</span> <span class="op">+</span>rates[<span class="st">'rP1'</span>]<span class="op">*</span>G1 <span class="op">-</span> rates[<span class="st">'rB1'</span>]<span class="op">*</span>P1<span class="op">*</span>G2 <span class="op">+</span> rates[<span class="st">'rU1'</span>]<span class="op">*</span>P1G2 <span class="op">-</span> rates[<span class="st">'rD1'</span>]<span class="op">*</span>P1</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>        d_P2_dt <span class="op">=</span> <span class="op">+</span>rates[<span class="st">'rP2'</span>]<span class="op">*</span>G2 <span class="op">-</span> rates[<span class="st">'rB2'</span>]<span class="op">*</span>P2<span class="op">*</span>G3 <span class="op">+</span> rates[<span class="st">'rU2'</span>]<span class="op">*</span>P2G3 <span class="op">-</span> rates[<span class="st">'rD2'</span>]<span class="op">*</span>P2</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>        d_P3_dt <span class="op">=</span> <span class="op">+</span>rates[<span class="st">'rP3'</span>]<span class="op">*</span>G3 <span class="op">-</span> rates[<span class="st">'rB3'</span>]<span class="op">*</span>P3<span class="op">*</span>G1 <span class="op">+</span> rates[<span class="st">'rU3'</span>]<span class="op">*</span>P3G1 <span class="op">-</span> rates[<span class="st">'rD3'</span>]<span class="op">*</span>P3</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>        d_P1G2_dt <span class="op">=</span> <span class="op">+</span>rates[<span class="st">'rB1'</span>]<span class="op">*</span>P1<span class="op">*</span>G2 <span class="op">-</span> rates[<span class="st">'rU1'</span>]<span class="op">*</span>P1G2</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>        d_P2G3_dt <span class="op">=</span> <span class="op">+</span>rates[<span class="st">'rB2'</span>]<span class="op">*</span>P2<span class="op">*</span>G3 <span class="op">-</span> rates[<span class="st">'rU2'</span>]<span class="op">*</span>P2G3</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>        d_P3G1_dt <span class="op">=</span> <span class="op">+</span>rates[<span class="st">'rB3'</span>]<span class="op">*</span>P3<span class="op">*</span>G1 <span class="op">-</span> rates[<span class="st">'rU3'</span>]<span class="op">*</span>P3G1</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> [d_G1_dt, d_G2_dt, d_G3_dt, d_P1_dt, d_P2_dt, d_P3_dt, d_P1G2_dt, d_P2G3_dt, d_P3G1_dt]</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>    x0 <span class="op">=</span> [init[<span class="st">'G1'</span>], init[<span class="st">'G2'</span>], init[<span class="st">'G3'</span>], init[<span class="st">'P1'</span>], init[<span class="st">'P2'</span>], init[<span class="st">'P3'</span>], init[<span class="st">'P1G2'</span>], init[<span class="st">'P2G3'</span>], init[<span class="st">'P3G1'</span>]]</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> odeint(neg_feedback_loop, x0, t, args<span class="op">=</span>(rates,))</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>    results_df <span class="op">=</span> pd.DataFrame(y, columns<span class="op">=</span>[<span class="st">'$G_1$'</span>, <span class="st">'$G_2$'</span>, <span class="st">'$G_3$'</span>, <span class="st">'$P_1$'</span>, <span class="st">'$P_2$'</span>, <span class="st">'$P_3$'</span>, <span class="st">'$P_1G_2$'</span>, <span class="st">'$P_2G_3$'</span>, <span class="st">'$P_3G_1$'</span>])</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> results_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Simulate the system for 50 time units with the following initial conditions:</p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> np.linspace(<span class="dv">0</span>,<span class="dv">50</span>,<span class="dv">51</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>rates <span class="op">=</span> {</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'rP1'</span>: <span class="dv">10</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'rP2'</span>: <span class="dv">10000</span>,</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'rP3'</span>: <span class="dv">10</span>,</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'rB1'</span>: <span class="dv">10</span>,</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'rB2'</span>: <span class="fl">0.1</span>,</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'rB3'</span>: <span class="dv">10</span>,</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'rU1'</span>: <span class="dv">2</span>,</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'rU2'</span>: <span class="dv">20</span>,</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'rU3'</span>: <span class="dv">20</span>,</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">'rD1'</span>: <span class="dv">1</span>,</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">'rD2'</span>: <span class="dv">100</span>,</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">'rD3'</span>: <span class="dv">1</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>init <span class="op">=</span> {</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">'G1'</span>: <span class="dv">1</span>,</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">'G2'</span>: <span class="dv">1</span>,</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">'G3'</span>: <span class="dv">1</span>,</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">'P1'</span>: <span class="dv">0</span>,</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">'P2'</span>: <span class="dv">0</span>,</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">'P3'</span>: <span class="dv">0</span>,</span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">'P1G2'</span>: <span class="dv">0</span>,</span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">'P2G3'</span>: <span class="dv">0</span>,</span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">'P3G1'</span>: <span class="dv">0</span></span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>results_df <span class="op">=</span> ODE_solver(t, rates, init)</span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>results_df[[<span class="st">'$P_1$'</span>, <span class="st">'$P_2$'</span>, <span class="st">'$P_3$'</span>]].plot(figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">5</span>), color<span class="op">=</span>[<span class="st">'red'</span>, <span class="st">'green'</span>, <span class="st">'blue'</span>], marker<span class="op">=</span><span class="st">"o"</span>)</span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>results_df[[<span class="st">'$P_3G_1$'</span>, <span class="st">'$G_1$'</span>]].plot(figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">5</span>), color<span class="op">=</span>[<span class="st">'black'</span>, <span class="st">'darkturquoise'</span>], marker<span class="op">=</span><span class="st">"o"</span>)</span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>results_df[[<span class="st">'$P_1G_2$'</span>, <span class="st">'$G_2$'</span>]].plot(figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">5</span>), color<span class="op">=</span>[<span class="st">'black'</span>, <span class="st">'magenta'</span>], marker<span class="op">=</span><span class="st">"o"</span>)</span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>results_df[[<span class="st">'$P_2G_3$'</span>, <span class="st">'$G_3$'</span>]].plot(figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">5</span>), color<span class="op">=</span>[<span class="st">'black'</span>, <span class="st">'gold'</span>], marker<span class="op">=</span><span class="st">"o"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>&lt;Axes: &gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="negative_feedback_loop_files/figure-html/cell-14-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="negative_feedback_loop_files/figure-html/cell-14-output-3.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="negative_feedback_loop_files/figure-html/cell-14-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="negative_feedback_loop_files/figure-html/cell-14-output-5.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.integrate <span class="im">import</span> ode</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ODE_solver2(t, rates, init, method<span class="op">=</span><span class="st">'dop853'</span>):</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">'''</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Solve the initial value problem for the ODE system using scipy.integrate.ode.</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="co">    '''</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> neg_feedback_loop(t, x, rates):</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>        G1, G2, G3, P1, P2, P3, P1G2, P2G3, P3G1 <span class="op">=</span> x</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>        d_G1_dt <span class="op">=</span> <span class="op">-</span>rates[<span class="st">'rB3'</span>]<span class="op">*</span>P3<span class="op">*</span>G1 <span class="op">+</span> rates[<span class="st">'rU3'</span>]<span class="op">*</span>P3G1</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>        d_G2_dt <span class="op">=</span> <span class="op">-</span>rates[<span class="st">'rB1'</span>]<span class="op">*</span>P1<span class="op">*</span>G2 <span class="op">+</span> rates[<span class="st">'rU1'</span>]<span class="op">*</span>P1G2</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>        d_G3_dt <span class="op">=</span> <span class="op">-</span>rates[<span class="st">'rB2'</span>]<span class="op">*</span>P2<span class="op">*</span>G3 <span class="op">+</span> rates[<span class="st">'rU2'</span>]<span class="op">*</span>P2G3</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>        d_P1_dt <span class="op">=</span> <span class="op">+</span>rates[<span class="st">'rP1'</span>]<span class="op">*</span>G1 <span class="op">-</span> rates[<span class="st">'rB1'</span>]<span class="op">*</span>P1<span class="op">*</span>G2 <span class="op">+</span> rates[<span class="st">'rU1'</span>]<span class="op">*</span>P1G2 <span class="op">-</span> rates[<span class="st">'rD1'</span>]<span class="op">*</span>P1</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>        d_P2_dt <span class="op">=</span> <span class="op">+</span>rates[<span class="st">'rP2'</span>]<span class="op">*</span>G2 <span class="op">-</span> rates[<span class="st">'rB2'</span>]<span class="op">*</span>P2<span class="op">*</span>G3 <span class="op">+</span> rates[<span class="st">'rU2'</span>]<span class="op">*</span>P2G3 <span class="op">-</span> rates[<span class="st">'rD2'</span>]<span class="op">*</span>P2</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>        d_P3_dt <span class="op">=</span> <span class="op">+</span>rates[<span class="st">'rP3'</span>]<span class="op">*</span>G3 <span class="op">-</span> rates[<span class="st">'rB3'</span>]<span class="op">*</span>P3<span class="op">*</span>G1 <span class="op">+</span> rates[<span class="st">'rU3'</span>]<span class="op">*</span>P3G1 <span class="op">-</span> rates[<span class="st">'rD3'</span>]<span class="op">*</span>P3</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>        d_P1G2_dt <span class="op">=</span> <span class="op">+</span>rates[<span class="st">'rB1'</span>]<span class="op">*</span>P1<span class="op">*</span>G2 <span class="op">-</span> rates[<span class="st">'rU1'</span>]<span class="op">*</span>P1G2</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>        d_P2G3_dt <span class="op">=</span> <span class="op">+</span>rates[<span class="st">'rB2'</span>]<span class="op">*</span>P2<span class="op">*</span>G3 <span class="op">-</span> rates[<span class="st">'rU2'</span>]<span class="op">*</span>P2G3</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>        d_P3G1_dt <span class="op">=</span> <span class="op">+</span>rates[<span class="st">'rB3'</span>]<span class="op">*</span>P3<span class="op">*</span>G1 <span class="op">-</span> rates[<span class="st">'rU3'</span>]<span class="op">*</span>P3G1</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> [d_G1_dt, d_G2_dt, d_G3_dt, d_P1_dt, d_P2_dt, d_P3_dt, d_P1G2_dt, d_P2G3_dt, d_P3G1_dt]</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert the time vector to a list of times for interpolation</span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>    t_values <span class="op">=</span> np.array(t)</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>    y_values <span class="op">=</span> np.zeros((<span class="bu">len</span>(t_values), <span class="dv">9</span>))</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initial conditions</span></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>    x0 <span class="op">=</span> [init[<span class="st">'G1'</span>], init[<span class="st">'G2'</span>], init[<span class="st">'G3'</span>], init[<span class="st">'P1'</span>], init[<span class="st">'P2'</span>], init[<span class="st">'P3'</span>], init[<span class="st">'P1G2'</span>], init[<span class="st">'P2G3'</span>], init[<span class="st">'P3G1'</span>]]</span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create an ODE integrator object</span></span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a>    solver <span class="op">=</span> ode(<span class="kw">lambda</span> t, x: neg_feedback_loop(t, x, rates))</span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a>    solver.set_integrator(method)  <span class="co"># You can choose different integrators available in scipy</span></span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a>    solver.set_initial_value(x0, t[<span class="dv">0</span>])</span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Integrate the ODE system</span></span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(t_values)):</span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> solver.successful() <span class="kw">and</span> solver.t <span class="op">&lt;</span> t_values[i]:</span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a>            solver.integrate(t_values[i])</span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a>        y_values[i, :] <span class="op">=</span> solver.y</span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a DataFrame from the results</span></span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true" tabindex="-1"></a>    results_df <span class="op">=</span> pd.DataFrame(y_values, columns<span class="op">=</span>[<span class="st">'$G_1$'</span>, <span class="st">'$G_2$'</span>, <span class="st">'$G_3$'</span>, <span class="st">'$P_1$'</span>, <span class="st">'$P_2$'</span>, <span class="st">'$P_3$'</span>, <span class="st">'$P_1G_2$'</span>, <span class="st">'$P_2G_3$'</span>, <span class="st">'$P_3G_1$'</span>])</span>
<span id="cb26-40"><a href="#cb26-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> results_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>results1_df <span class="op">=</span> ODE_solver2(t, rates, init, <span class="st">'vode'</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>results1_df[[<span class="st">'$P_1$'</span>, <span class="st">'$P_2$'</span>, <span class="st">'$P_3$'</span>]].plot(figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">5</span>), color<span class="op">=</span>[<span class="st">'red'</span>, <span class="st">'green'</span>, <span class="st">'blue'</span>], marker<span class="op">=</span><span class="st">"o"</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>results2_df <span class="op">=</span> ODE_solver2(t, rates, init, <span class="st">'zvode'</span>)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>results2_df[[<span class="st">'$P_1$'</span>, <span class="st">'$P_2$'</span>, <span class="st">'$P_3$'</span>]].plot(figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">5</span>), color<span class="op">=</span>[<span class="st">'red'</span>, <span class="st">'green'</span>, <span class="st">'blue'</span>], marker<span class="op">=</span><span class="st">"o"</span>)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>results3_df <span class="op">=</span> ODE_solver2(t, rates, init, <span class="st">'lsoda'</span>)</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>results3_df[[<span class="st">'$P_1$'</span>, <span class="st">'$P_2$'</span>, <span class="st">'$P_3$'</span>]].plot(figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">5</span>), color<span class="op">=</span>[<span class="st">'red'</span>, <span class="st">'green'</span>, <span class="st">'blue'</span>], marker<span class="op">=</span><span class="st">"o"</span>)</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>results4_df <span class="op">=</span> ODE_solver2(t, rates, init, <span class="st">'dopri5'</span>)</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>results4_df[[<span class="st">'$P_1$'</span>, <span class="st">'$P_2$'</span>, <span class="st">'$P_3$'</span>]].plot(figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">5</span>), color<span class="op">=</span>[<span class="st">'red'</span>, <span class="st">'green'</span>, <span class="st">'blue'</span>], marker<span class="op">=</span><span class="st">"o"</span>)</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>results5_df <span class="op">=</span> ODE_solver2(t, rates, init, <span class="st">'dop853'</span>)</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>results5_df[[<span class="st">'$P_1$'</span>, <span class="st">'$P_2$'</span>, <span class="st">'$P_3$'</span>]].plot(figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">5</span>), color<span class="op">=</span>[<span class="st">'red'</span>, <span class="st">'green'</span>, <span class="st">'blue'</span>], marker<span class="op">=</span><span class="st">"o"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/var/folders/8n/f3j9y6bd3zd_kp83y0vvn_b80000gn/T/ipykernel_6167/3099431408.py:36: ComplexWarning: Casting complex values to real discards the imaginary part
  y_values[i, :] = solver.y</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>&lt;Axes: &gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="negative_feedback_loop_files/figure-html/cell-16-output-3.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="negative_feedback_loop_files/figure-html/cell-16-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="negative_feedback_loop_files/figure-html/cell-16-output-5.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="negative_feedback_loop_files/figure-html/cell-16-output-6.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="negative_feedback_loop_files/figure-html/cell-16-output-7.png" class="img-fluid"></p>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Â© 2024 Irene Testa</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>



</body></html>